<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="google-adsense-account" content="ca-pub-9952387808707527">
    <title>Court Mate - Smart AI Agent</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>

    <!-- Tournament Data -->
    <script src="data/2026_tournaments.js"></script>
    <!-- tournaments.js removed to prevent data conflict -->

    <!-- ‚úÖ ÏàòÏ†ï: ÏóêÎü¨ Ï≤òÎ¶¨ Ï∂îÍ∞Ä -->
    <script src="rankings_data.js?v=20260211" onerror="console.error('Failed to load rankings_data.js')"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@400;600;800&family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9952387808707527"
        crossorigin="anonymous"></script>

    <script data-noptimize="1" data-cfasync="false" data-wpfc-render="false">
        (function () {
            var script = document.createElement("script");
            script.async = 1;
            script.src = 'https://emrld.cc/NDk3NDMy.js?t=497432';
            document.head.appendChild(script);
        })();
    </script>

    <style>
        /* --- [Core] CSS Variables & Reset --- */
        :root {
            --primary: #10B981;
            --primary-dark: #059669;
            --slate-900: #0f172a;
            --slate-800: #1e293b;
            --slate-700: #334155;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --white: #ffffff;

            /* Status Colors */
            --color-mandatory: #7e22ce;
            --color-main: #10b981;
            --color-qual: #eab308;
            --color-promo: #f59e0b;
            --color-reserve: #9ca3af;

            /* Transitions */
            --pastel-green: #6ee7b7;
            --pastel-blue: #93c5fd;
            --pastel-indigo: #a5b4fc;
            --pastel-purple: #d8b4fe;
            --pastel-teal: #5eead4;

            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--gray-100);
            font-family: 'Inter', 'Noto Sans KR', 'Noto Sans SC', 'Noto Sans JP', sans-serif;
            color: var(--slate-900);
            font-size: 14px;
        }

        [v-cloak] {
            display: none !important;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button,
        input,
        select,
        textarea {
            font-family: inherit;
            outline: none;
        }

        /* --- [Layout] App Container --- */
        .app-container {
            max-width: 480px;
            width: 100%;
            margin: 0 auto;
            background-color: var(--white);
            min-height: 100vh;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
        }

        .flex-1 {
            flex: 1;
        }

        .p-4 {
            padding: 1rem;
        }

        .p-5 {
            padding: 1.25rem;
        }

        .p-6 {
            padding: 1.5rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .text-center {
            text-align: center;
        }

        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .flex-center {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        /* --- [Components] UI Elements --- */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.875rem;
            border-radius: 0.75rem;
            font-weight: 700;
            font-size: 0.875rem;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
            border: none;
            width: 100%;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--slate-800);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-emerald {
            background: var(--primary);
            color: white;
        }

        .btn-ghost {
            background: var(--white);
            border: 1px solid var(--gray-200);
            color: var(--slate-700);
        }

        .card {
            background: white;
            border-radius: 1rem;
            padding: 1.25rem;
            border: 1px solid var(--gray-100);
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }

        .label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--gray-500);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid var(--gray-200);
            background: var(--gray-50);
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        input:focus,
        select:focus {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 2px var(--pastel-green);
            outline: none;
        }

        /* ‚úÖ Ï∂îÍ∞Ä: ÏûÖÎ†• ÏóêÎü¨ Ïä§ÌÉÄÏùº */
        input.error {
            border-color: #ef4444;
        }

        .error-message {
            color: #ef4444;
            font-size: 0.65rem;
            margin-top: 0.25rem;
        }

        /* --- [Feature] Branding --- */
        .brand-text {
            font-family: 'Pacifico', cursive;
            font-size: 1.75rem;
            line-height: 1;
            color: var(--primary);
            transition: color 0.5s ease;
        }

        .text-pastel-green {
            color: var(--pastel-green);
        }

        .inline-header-container {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .brand-text-center {
            text-align: center;
            justify-self: center;
        }

        /* Dark Mode Toggle Button */
        .dark-mode-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--gray-200);
            background: var(--white);
            color: var(--slate-700);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .dark-mode-toggle:hover {
            background: var(--gray-50);
            transform: scale(1.05);
        }

        .dark-mode-toggle:active {
            transform: scale(0.95);
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #0f172a;
            color: #e2e8f0;
        }

        body.dark-mode .app-container {
            background-color: #1e293b;
        }

        body.dark-mode .card {
            background: #334155;
            border-color: #475569;
        }

        body.dark-mode input[type="text"],
        body.dark-mode input[type="number"],
        body.dark-mode select {
            background: #1e293b;
            border-color: #475569;
            color: #e2e8f0;
        }

        body.dark-mode .btn-primary {
            background: #0ea5e9;
        }

        body.dark-mode .global-footer-bar {
            background: #1e293b;
            border-color: #475569;
        }

        body.dark-mode .dark-mode-toggle {
            background: #475569;
            border-color: #64748b;
            color: #fbbf24;
        }

        /* --- [Feature] Global Footer --- */
        .global-footer-bar {
            position: fixed;
            bottom: 3rem;
            width: 100%;
            max-width: 480px;
            height: 3rem;
            background: var(--white);
            border-top: 1px solid var(--gray-200);
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            align-items: center;
            z-index: 110;
        }

        .footer-col {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--slate-700);
            cursor: pointer;
        }

        .footer-brand {
            font-family: 'Pacifico', cursive;
            font-size: 1.1rem;
            color: #1974D2;
            cursor: default;
        }

        .footer-col:not(.footer-brand):active {
            background: var(--gray-50);
        }

        /* --- [Feature] Simulator --- */
        .sim-toggle {
            display: flex;
            background: var(--gray-100);
            padding: 4px;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .sim-toggle-btn {
            flex: 1;
            padding: 0.5rem;
            border: none;
            border-radius: 0.375rem;
            font-weight: 700;
            font-size: 0.75rem;
            cursor: pointer;
            color: var(--gray-400);
            background: transparent;
        }

        .sim-toggle-btn.active {
            background: white;
            color: var(--slate-900);
            box-shadow: var(--shadow);
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--slate-700);
            cursor: pointer;
        }

        .radio-item input {
            width: auto;
            margin: 0;
            accent-color: var(--primary);
        }

        .res-card {
            padding: 0.75rem;
            border-left: 4px solid var(--gray-400);
            border-radius: 0.5rem;
            background: white;
            margin-bottom: 0.5rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .res-grade {
            display: inline-block;
            font-size: 0.65rem;
            font-weight: 800;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--slate-700);
            color: white;
            margin-bottom: 4px;
            margin-right: 4px;
        }

        .action-btn {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            padding: 6px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 700;
            color: var(--gray-500);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        /* --- Animations --- */
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Modals & Share --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        .social-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            width: 100%;
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.8rem;
            border: none;
            cursor: pointer;
            color: white;
        }

        .share-sticky-btn {
            position: fixed;
            bottom: 7.5rem;
            right: 1.5rem;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background: var(--slate-800);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: var(--shadow-lg);
            z-index: 90;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }

        .share-sticky-btn:active {
            transform: scale(0.9);
        }

        .search-item {
            cursor: pointer;
            transition: background-color 0.15s;
        }

        .search-item:hover {
            background-color: var(--gray-50);
        }

        /* ‚úÖ Ï∂îÍ∞Ä: Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏóêÎü¨ ÏïåÎ¶º */
        .data-error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.75rem;
        }

        /* ‚úÖ NEW: Tournament Filter Panel */
        .filter-panel {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            border: 1px solid var(--gray-200);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .filter-section {
            margin-bottom: 0.75rem;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--gray-500);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            display: block;
        }

        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .filter-chip {
            padding: 0.3rem 0.6rem;
            border-radius: 999px;
            font-size: 0.65rem;
            font-weight: 600;
            border: 1.5px solid var(--gray-300);
            background: white;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .filter-chip:hover {
            border-color: var(--primary);
            background: var(--gray-50);
        }

        .filter-chip.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ‚úÖ NEW: Countdown Timer */
        .timer-container {
            text-align: center;
            padding: 1rem;
            margin-top: 1rem;
        }

        .timer-display {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-family: 'Inter', monospace;
        }

        .timer-label {
            font-size: 0.7rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* ‚úÖ NEW: Player Advice Message */
        .player-advice {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            margin-top: 0.75rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.2);
        }

        .player-advice-text {
            font-size: 0.7rem;
            font-weight: 700;
            color: #92400e;
            line-height: 1.5;
        }

        /* ‚úÖ NEW: Tournament Selection Checkboxes */
        .tournament-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
            margin-right: 0.5rem;
        }

        .selected-tournament-card {
            box-shadow: 0 0 0 3px var(--pastel-green);
            background: linear-gradient(to right, #f0fdf4, white);
        }

        .plan-circuit-btn {
            position: fixed;
            bottom: 7rem;
            left: 50%;
            transform: translateX(-50%);
            max-width: 440px;
            width: calc(100% - 3rem);
            z-index: 100;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Multi-Tournament Selection */
        .tournament-card-wrapper {
            position: relative;
            transition: all 0.2s ease;
        }

        .tournament-card-wrapper.selected {
            box-shadow: 0 0 0 3px var(--pastel-green);
            border-radius: 0.5rem;
        }

        .tournament-checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            user-select: none;
        }

        /* Safety Warning Footer */
        .safety-warning-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 480px;
            margin: 0 auto;
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-top: 3px solid #dc2626;
            padding: 0.5rem 1rem;
            text-align: center;
            z-index: 105;
            box-shadow: 0 -4px 6px -1px rgba(220, 38, 38, 0.3);
        }

        .safety-warning-text {
            font-size: 0.7rem;
            font-weight: 800;
            color: #991b1b;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            line-height: 1.4;
        }

        .safety-warning-icon {
            color: #dc2626;
            margin-right: 0.5rem;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <div id="app" class="app-container" v-cloak>
        <!--  NEW: Circuit Planner Modal -->
        <div v-if="showCircuitModal"
            class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4"
            style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 1rem;">
            <div class="bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden border border-gray-700"
                style="background-color: #1f2937; border-radius: 1rem; width: 100%; max-width: 28rem; border: 1px solid #374151; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);">
                <div class="p-6" style="padding: 1.5rem;">
                    <div class="flex justify-between items-center mb-6"
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 class="text-xl font-bold text-white flex items-center gap-2"
                            style="font-size: 1.25rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.5rem; margin: 0;">
                            <i class="fas fa-plane-departure text-blue-400" style="color: #60a5fa;"></i>
                            Circuit Planner
                        </h3>
                        <button @click="showCircuitModal = false"
                            class="text-gray-400 hover:text-white transition-colors"
                            style="background: none; border: none; color: #9ca3af; cursor: pointer; font-size: 1.25rem;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <p class="text-gray-400 text-sm mb-6"
                        style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 1.5rem;">
                        Enter your departure city to find the best flight combinations for your selected tournaments.
                    </p>

                    <!-- Departure City Input -->
                    <div class="mb-6 relative" style="margin-bottom: 1.5rem; position: relative;">
                        <label class="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2"
                            style="display: block; font-size: 0.75rem; font-weight: 600; color: #9ca3af; text-transform: uppercase; margin-bottom: 0.5rem;">
                            Departure City
                        </label>
                        <div class="relative" style="position: relative;">
                            <i class="fas fa-search absolute left-4 top-3.5 text-gray-500"
                                style="position: absolute; left: 1rem; top: 0.875rem; color: #6b7280;"></i>
                            <input type="text" v-model="circuitHomeCityQuery" @input="fetchCitySuggestions"
                                placeholder="e.g. Seoul, London, Paris"
                                class="w-full bg-gray-700 border border-gray-600 rounded-xl py-3 pl-11 pr-4 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all font-medium"
                                style="width: 100%; background-color: #374151; border: 1px solid #4b5563; border-radius: 0.75rem; padding: 0.75rem 1rem 0.75rem 2.75rem; color: white; display: block;">
                            <!-- Autocomplete Dropdown -->
                            <ul v-if="citySuggestions.length > 0"
                                class="absolute z-10 w-full bg-gray-700 border border-gray-600 rounded-xl mt-2 shadow-xl max-h-60 overflow-y-auto custom-scrollbar"
                                style="position: absolute; z-index: 100; width: 100%; background-color: #374151; border: 1px solid #4b5563; border-radius: 0.75rem; margin-top: 0.5rem; max-height: 15rem; overflow-y: auto; list-style: none; padding: 0;">
                                <li v-for="city in citySuggestions" :key="city.code" @click="selectHomeCity(city)"
                                    class="px-4 py-3 hover:bg-gray-600 cursor-pointer flex justify-between items-center border-b border-gray-600 last:border-0 transition-colors"
                                    style="padding: 0.75rem 1rem; border-bottom: 1px solid #4b5563; display: flex; justify-content: space-between; align-items: center; cursor: pointer;">
                                    <div>
                                        <span class="text-white font-medium block"
                                            style="color: white; font-weight: 500; display: block;">{{ city.name
                                            }}</span>
                                        <span class="text-xs text-gray-400"
                                            style="font-size: 0.75rem; color: #9ca3af;">{{ city.country_name }}</span>
                                    </div>
                                    <span class="text-blue-400 font-bold bg-blue-900/30 px-2 py-1 rounded text-xs"
                                        style="color: #60a5fa; font-weight: 700; background-color: rgba(30, 58, 138, 0.3); padding: 0.25rem 0.5rem; border-radius: 0.25rem;">{{
                                        city.code }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Selected Route Preview -->
                    <div v-if="selectedTournaments.length > 0 && circuitHomeCode"
                        class="bg-gray-900/50 rounded-xl p-4 mb-6 border border-gray-700/50"
                        style="background-color: rgba(17, 24, 39, 0.5); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1.5rem; border: 1px solid rgba(55, 65, 81, 0.5);">
                        <div class="flex items-center gap-2 text-sm text-gray-300 mb-2"
                            style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #d1d5db; margin-bottom: 0.5rem;">
                            <i class="fas fa-route text-blue-400" style="color: #60a5fa;"></i>
                            <span class="font-semibold" style="font-weight: 600;">Your Route:</span>
                        </div>
                        <div class="flex flex-wrap items-center gap-2 text-xs text-gray-400"
                            style="display: flex; flex-wrap: wrap; align-items: center; gap: 0.5rem; font-size: 0.75rem; color: #9ca3af;">
                            <span class="text-white bg-blue-600 px-2 py-0.5 rounded"
                                style="color: white; background-color: #2563eb; padding: 0.125rem 0.5rem; border-radius: 0.25rem;">{{
                                circuitHomeCode }}</span>
                            <i class="fas fa-arrow-right text-gray-600" style="color: #4b5563;"></i>
                            <template v-for="(tId, idx) in selectedTournaments" :key="tId">
                                <span class="text-white" style="color: white;">{{ getCityCode(tId) }}</span>
                                <i class="fas fa-arrow-right text-gray-600" style="color: #4b5563;"></i>
                            </template>
                            <span class="text-white bg-blue-600 px-2 py-0.5 rounded"
                                style="color: white; background-color: #2563eb; padding: 0.125rem 0.5rem; border-radius: 0.25rem;">{{
                                circuitHomeCode }}</span>
                        </div>
                    </div>

                    <!-- Action Button -->
                    <button @click="generateComparisonLink" :disabled="!circuitHomeCode"
                        class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-4 rounded-xl shadow-lg transform transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                        style="width: 100%; background: linear-gradient(to right, #2563eb, #4f46e5); color: white; font-weight: 700; padding: 1rem; border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); display: flex; justify-content: center; align-items: center; gap: 0.5rem; border: none; cursor: pointer; transition: all 0.2s;">
                        <span>Find Lowest Prices</span>
                        <i class="fas fa-external-link-alt"></i>
                    </button>

                    <p class="text-center text-xs text-gray-500 mt-4"
                        style="text-align: center; font-size: 0.75rem; color: #6b7280; margin-top: 1rem;">
                        Powered by <span class="text-blue-400 font-semibold"
                            style="color: #60a5fa; font-weight: 600;">Aviasales</span> Price Comparison
                    </p>
                </div>
            </div>
        </div>

        <footer class="global-footer-bar">
            <a class="footer-col" href="https://corporate.bwfbadminton.com/events/calendar/" target="_blank"
                rel="noopener noreferrer" style="text-decoration:none;">
                <i class="fa-regular fa-calendar-check" style="margin-right:4px;"></i> {{ t('footerCalendar') }}
            </a>
            <div class="footer-col footer-brand">Court Mate</div>
            <div class="footer-col" @click="showConsultModal = true">
                <i class="fa-solid fa-headset" style="margin-right:4px;"></i> {{ t('footerConsult') }}
            </div>
        </footer>

        <div class="flex-1" style="overflow-y:auto; padding-bottom:7rem;">
            <div class="p-6">
                <div class="inline-header-container">
                    <button @click="toggleDarkMode" class="dark-mode-toggle"
                        :title="darkMode ? 'Light Mode' : 'Dark Mode'">
                        <i :class="darkMode ? 'fa-solid fa-sun' : 'fa-solid fa-moon'"></i>
                    </button>
                    <h1 class="brand-text text-pastel-green brand-text-center">Court Mate</h1>
                    <select v-model="currentLang"
                        style="width: 80px; padding:4px; border-radius:99px; font-size:11px; font-weight:700;">
                        <option value="en">üá∫üá∏ English</option>
                        <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                        <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                        <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                    </select>
                </div>

                <!-- ‚úÖ Ï∂îÍ∞Ä: Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå® Í≤ΩÍ≥† -->
                <div v-if="dataLoadError" class="data-error">
                    <i class="fa-solid fa-triangle-exclamation"></i> {{ t('dataLoadError') }}
                </div>

                <div class="card animate-fade-in">
                    <div class="mb-4 relative"
                        style="border-bottom:1px solid var(--gray-100); padding-bottom:1rem; margin-bottom:1rem;">
                        <div class="flex-between mb-2">
                            <label class="label" style="margin-bottom:0;">{{ t('searchTitle') }}</label>
                            <div style="display:flex; align-items:center; gap:0.5rem;">
                                <label
                                    style="display:flex; align-items:center; gap:4px; cursor:pointer; user-select:none;">
                                    <input type="checkbox" v-model="rememberPlayer"
                                        style="width:13px; height:13px; margin:0; accent-color:var(--primary); cursor:pointer;">
                                    <span
                                        style="font-size:0.65rem; color:var(--gray-500); font-weight:700; text-transform:uppercase; letter-spacing:0.02em;">{{
                                        t('searchRememberMe') }}</span>
                                </label>
                                <span style="font-size:0.65rem; color:var(--primary); cursor:pointer; margin-left:4px;"
                                    @click="clearSearch" v-if="searchQuery">{{ t('searchClear') }}</span>
                            </div>
                        </div>
                        <div style="position:relative;">
                            <input type="text" v-model="searchQuery" @focus="showSearchResults = true"
                                @input="showSearchResults = true" :placeholder="t('searchPlaceholder')"
                                style="padding-left: 2.25rem;" aria-label="Search players">
                            <i class="fa-solid fa-magnifying-glass"
                                style="position:absolute; left:1rem; top:50%; transform:translateY(-50%); color:var(--gray-400);"></i>
                        </div>

                        <!-- ‚úÖ ÏàòÏ†ï: Í≤ÄÏÉâ Í≤∞Í≥º ÌëúÏãú Í∞úÏÑ† -->
                        <div v-if="searchQuery && showSearchResults && searchResults.length > 0"
                            style="background:white; border:1px solid var(--gray-200); border-radius:0.5rem; margin-top:4px; margin-bottom:1rem; box-shadow:var(--shadow); width:100%; max-height: 300px; overflow-y: auto;">
                            <div v-for="p in searchResults" :key="p.id + p.category" @click="selectPlayer(p)"
                                class="search-item"
                                style="padding:0.75rem; border-bottom:1px solid var(--gray-100); cursor:pointer; display:flex; justify-content:space-between; align-items:center;"
                                role="button" tabindex="0" @keydown.enter="selectPlayer(p)">
                                <div>
                                    <div style="font-weight:700; font-size:0.8rem;">{{ p.name }}</div>
                                    <div style="font-size:0.65rem; color:var(--gray-500);">{{ p.country }} ‚Ä¢ {{
                                        p.category }} #{{ p.rank }}</div>
                                </div>
                                <div style="font-weight:700; font-size:0.75rem; color:var(--primary);">{{
                                    formatPoints(p.points) }} pts</div>
                            </div>
                        </div>
                        <div v-else-if="searchQuery && showSearchResults"
                            style="background:white; border:1px solid var(--gray-200); border-radius:0.5rem; margin-top:4px; padding:0.75rem; text-align:center; color:var(--gray-500); font-size:0.75rem;">
                            {{ t('noPlayersFound') }}
                        </div>
                    </div>

                    <div class="flex-between mb-4">
                        <h3 style="font-weight:700; color:var(--slate-800); font-size:0.875rem;"><i
                                class="fa-solid fa-plane-departure" style="color:#3B82F6; margin-right:6px;"></i> {{
                            t('simTitle') }}</h3>
                    </div>

                    <div class="sim-toggle">
                        <button @click="sim.type = 'singles'" class="sim-toggle-btn"
                            :class="{active: sim.type === 'singles'}">{{ t('simSingles') }}</button>
                        <button @click="sim.type = 'doubles'" class="sim-toggle-btn"
                            :class="{active: sim.type === 'doubles'}">{{ t('simDoubles') }}</button>
                    </div>

                    <div
                        style="background:#eff6ff; padding:1rem; border-radius:0.75rem; border:1px solid #dbeafe; margin-bottom:1rem;">
                        <p style="font-size:10px; font-weight:700; color:#3b82f6; margin-bottom:0.5rem;"><i
                                class="fa-solid fa-circle-info mr-1"></i> {{ t('playerInfo') }}</p>
                        <div class="radio-group">
                            <template v-if="sim.type === 'singles'">
                                <label class="radio-item"><input type="radio" v-model="sim.guestEvent" value="MS">
                                    MS</label>
                                <label class="radio-item"><input type="radio" v-model="sim.guestEvent" value="WS">
                                    WS</label>
                            </template>
                            <template v-else>
                                <label class="radio-item"><input type="radio" v-model="sim.guestEvent" value="MD">
                                    MD</label>
                                <label class="radio-item"><input type="radio" v-model="sim.guestEvent" value="WD">
                                    WD</label>
                                <label class="radio-item"><input type="radio" v-model="sim.guestEvent" value="XD">
                                    XD</label>
                            </template>
                        </div>
                        <div class="grid-2">
                            <div>
                                <input v-model.number="sim.guestPoints" type="number" :placeholder="t('rankPoints')"
                                    :class="{'error': validationErrors.points}" min="0" max="999999"
                                    @input="validateInputs">
                                <p v-if="validationErrors.points" class="error-message">{{ validationErrors.points }}
                                </p>
                            </div>
                            <div>
                                <input v-model.number="sim.currentRank" type="number" :placeholder="t('currentRank')"
                                    :class="{'error': validationErrors.rank}" min="1" max="100000"
                                    @input="validateInputs">
                                <p v-if="validationErrors.rank" class="error-message">{{ validationErrors.rank }}</p>
                            </div>
                        </div>
                    </div>

                    <div v-if="sim.type === 'doubles'"
                        style="background:var(--gray-50); padding:1rem; border-radius:0.75rem; border:1px solid var(--gray-200); margin-bottom:1rem;">
                        <p style="font-size:10px; font-weight:700; color:var(--gray-500); margin-bottom:0.5rem;">
                            <i class="fa-solid fa-user-group mr-1"></i> {{ t('partnerPoints') }}
                            <span style="color:var(--gray-400); font-weight:400;">({{ t('optional') }})</span>
                        </p>
                        <div>
                            <input v-model.number="sim.partnerPoints" type="number"
                                :placeholder="t('partnerPointsPlaceholder')" class="mb-4"
                                :class="{'error': validationErrors.partnerPoints}" min="0" max="999999"
                                @input="validateInputs">
                            <p v-if="validationErrors.partnerPoints" class="error-message">{{
                                validationErrors.partnerPoints }}</p>
                        </div>
                        <p style="font-size:0.6rem; color:var(--gray-400); margin-bottom:0.75rem;">
                            <i class="fa-solid fa-lightbulb"></i> {{ t('partnerPointsHint') }}
                        </p>
                        <div style="border-top:1px solid var(--gray-200); padding-top:0.75rem;">
                            <label class="label">{{ t('simCalcMethod') }}</label>

                            <div @click="sim.calcMethod = 'normal'"
                                style="background:white; border:1px solid; border-radius:0.5rem; padding:0.75rem; margin-bottom:0.5rem; cursor:pointer;"
                                :style="sim.calcMethod === 'normal' ? 'border-color:#3b82f6; box-shadow:0 0 0 1px #3b82f6;' : 'border-color:var(--gray-200);'">
                                <div class="flex-between mb-1"><span style="font-size:0.75rem; font-weight:700;">{{
                                        t('normal') }}</span>
                                    <div style="width:12px; height:12px; border-radius:50%; border:1px solid var(--gray-300);"
                                        :style="sim.calcMethod === 'normal' ? 'background:#3b82f6; border-color:#3b82f6;' : ''">
                                    </div>
                                </div>
                                <p style="font-size:0.65rem; color:var(--gray-400);">{{ t('normalDesc') }}</p>
                            </div>

                            <div @click="sim.calcMethod = 'notional'"
                                style="background:white; border:1px solid; border-radius:0.5rem; padding:0.75rem; margin-bottom:0.5rem; cursor:pointer;"
                                :style="sim.calcMethod === 'notional' ? 'border-color:#3b82f6; box-shadow:0 0 0 1px #3b82f6;' : 'border-color:var(--gray-200);'">
                                <div class="flex-between mb-1"><span style="font-size:0.75rem; font-weight:700;">{{
                                        t('simNotionalTitle') }}</span>
                                    <div style="width:12px; height:12px; border-radius:50%; border:1px solid var(--gray-300);"
                                        :style="sim.calcMethod === 'notional' ? 'background:#3b82f6; border-color:#3b82f6;' : ''">
                                    </div>
                                </div>
                                <p style="font-size:0.65rem; color:var(--gray-400);">{{ t('simNotionalDetail') }}</p>
                            </div>

                            <div @click="sim.calcMethod = 'adjusted'"
                                style="background:white; border:1px solid; border-radius:0.5rem; padding:0.75rem; cursor:pointer;"
                                :style="sim.calcMethod === 'adjusted' ? 'border-color:#3b82f6; box-shadow:0 0 0 1px #3b82f6;' : 'border-color:var(--gray-200);'">
                                <div class="flex-between mb-1"><span style="font-size:0.75rem; font-weight:700;">{{
                                        t('simAdjustedTitle') }}</span>
                                    <div style="width:12px; height:12px; border-radius:50%; border:1px solid var(--gray-300);"
                                        :style="sim.calcMethod === 'adjusted' ? 'background:#3b82f6; border-color:#3b82f6;' : ''">
                                    </div>
                                </div>
                                <select v-if="sim.calcMethod === 'adjusted'" v-model="sim.playedCount" @click.stop
                                    style="font-size:0.65rem; padding:4px; margin-top:4px;">
                                    <option value="5">{{ t('simOpt5') }}</option>
                                    <option value="6">{{ t('simOpt6') }}</option>
                                    <option value="7">{{ t('simOpt7') }}</option>
                                    <option value="8">{{ t('simOpt8') }}</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ‚úÖ NEW: Tournament Filter Panel -->
                    <div class="filter-panel" v-if="!sim.loading">
                        <div class="filter-section">
                            <span class="filter-label">{{ t('filterRegion') }}</span>
                            <div class="filter-chips">
                                <div class="filter-chip" :class="{active: filters.selectedRegions.length === 0}"
                                    @click="filters.selectedRegions = []">{{ t('filterAll') }}</div>
                                <div class="filter-chip" :class="{active: filters.selectedRegions.includes('Asia')}"
                                    @click="toggleRegionFilter('Asia')">{{ t('regionAsia') }}</div>
                                <div class="filter-chip" :class="{active: filters.selectedRegions.includes('Europe')}"
                                    @click="toggleRegionFilter('Europe')">{{ t('regionEurope') }}</div>
                                <div class="filter-chip" :class="{active: filters.selectedRegions.includes('PanAm')}"
                                    @click="toggleRegionFilter('PanAm')">{{ t('regionPanAm') }}</div>
                                <div class="filter-chip" :class="{active: filters.selectedRegions.includes('Africa')}"
                                    @click="toggleRegionFilter('Africa')">{{ t('regionAfrica') }}</div>
                                <div class="filter-chip" :class="{active: filters.selectedRegions.includes('Oceania')}"
                                    @click="toggleRegionFilter('Oceania')">{{ t('regionOceania') }}</div>
                            </div>
                        </div>
                        <div class="filter-section">
                            <span class="filter-label">{{ t('filterGrade') }}</span>
                            <div class="filter-chips">
                                <div class="filter-chip" :class="{active: filters.selectedGrades.length === 0}"
                                    @click="filters.selectedGrades = []">{{ t('filterAll') }}</div>
                                <div class="filter-chip" :class="{active: filters.selectedGrades.includes('S1000')}"
                                    @click="toggleGradeFilter('S1000')">Super 1000</div>
                                <div class="filter-chip" :class="{active: filters.selectedGrades.includes('S750')}"
                                    @click="toggleGradeFilter('S750')">Super 750</div>
                                <div class="filter-chip" :class="{active: filters.selectedGrades.includes('S500')}"
                                    @click="toggleGradeFilter('S500')">Super 500</div>
                                <div class="filter-chip" :class="{active: filters.selectedGrades.includes('S300')}"
                                    @click="toggleGradeFilter('S300')">Super 300</div>
                                <div class="filter-chip" :class="{active: filters.selectedGrades.includes('S100')}"
                                    @click="toggleGradeFilter('S100')">Super 100</div>
                                <div class="filter-chip" :class="{active: filters.selectedGrades.includes('IC')}"
                                    @click="toggleGradeFilter('IC')">Int. Challenge</div>
                                <div class="filter-chip" :class="{active: filters.selectedGrades.includes('IS')}"
                                    @click="toggleGradeFilter('IS')">Int. Series</div>
                                <div class="filter-chip" :class="{active: filters.selectedGrades.includes('Junior')}"
                                    @click="toggleGradeFilter('Junior')">Junior</div>
                            </div>
                        </div>
                    </div>

                    <button @click="runSimulation" class="btn btn-primary" :disabled="sim.loading || !isFormValid"
                        :title="!isFormValid ? t('fillRequiredFields') : ''">
                        <span v-if="!sim.loading">{{ t('simBtnRun') }}</span>
                        <span v-else>{{ t('simAnalyzing') }}</span>
                    </button>

                    <!-- ‚úÖ NEW: Log-Based Loading Screen -->
                    <div v-if="sim.loading"
                        style="margin-top:1rem; background:linear-gradient(135deg, #f0fdf4, #dcfce7); border:1px solid #86efac; border-radius:0.75rem; padding:1rem;"
                        class="animate-fade-in">
                        <div style="margin-bottom:0.75rem; text-align:center;">
                            <div
                                style="font-size:0.7rem; font-weight:700; color:#059669; text-transform:uppercase; letter-spacing:0.05em;">
                                AI Analysis in Progress</div>
                        </div>
                        <div v-for="(log, index) in loadingLogs" :key="index"
                            style="display:flex; align-items:center; gap:0.5rem; padding:0.4rem 0; font-size:0.7rem;">
                            <i :class="log.done ? 'fa-solid fa-check-circle' : 'fa-solid fa-spinner fa-spin'"
                                :style="{color: log.done ? '#10b981' : '#6b7280'}"></i>
                            <span
                                :style="{color: log.done ? '#059669' : '#6b7280', fontWeight: log.done ? '600' : '400'}">{{
                                log.message }}</span>
                        </div>
                        <div
                            style="margin-top:0.75rem; background:white; border-radius:0.5rem; height:6px; overflow:hidden;">
                            <div
                                :style="{width: loadingProgress + '%', height:'100%', background:'linear-gradient(90deg, #10b981, #059669)', transition:'width 0.3s ease'}">
                            </div>
                        </div>
                    </div>

                    <!-- ‚úÖ NEW: Player Advice Message -->
                    <div v-if="sim.loading" class="player-advice animate-fade-in">
                        <p class="player-advice-text">{{ t('playerAdvice') }}</p>
                    </div>

                    <!-- ‚úÖ Ï∂îÍ∞Ä: Î≤ÑÌäºÏù¥ ÎπÑÌôúÏÑ±ÌôîÎêú Ïù¥Ïú† ÌëúÏãú -->
                    <p v-if="!isFormValid && !sim.loading"
                        style="font-size:0.65rem; color:#ef4444; margin-top:0.5rem; text-align:center;">
                        <i class="fa-solid fa-circle-info"></i> {{ getValidationMessage() }}
                    </p>

                    <div v-if="sim.results"
                        style="margin-top:1.5rem; padding-top:1rem; border-top:1px solid var(--gray-100);"
                        class="animate-fade-in">
                        <p class="flex-between mb-2"><span
                                style="font-size:0.75rem; font-weight:700; color:var(--gray-500);">{{
                                t('simResultTitle') }}</span><span
                                style="font-size:0.65rem; font-weight:700; color:var(--primary);">Target</span></p>
                        <p style="font-size:0.6rem; color:var(--gray-400); margin-bottom:1rem; line-height:1.4;">
                            <i class="fa-solid fa-info-circle" style="margin-right:4px;"></i>{{
                            t('checkboxInstructions') }}
                        </p>
                        <div v-for="(res, idx) in filteredResults" :key="res.id" class="tournament-card-wrapper"
                            :class="{selected: selectedTournaments.includes(res.id)}">
                            <div class="res-card"
                                :style="{'border-color': res.statusKey === 'mandatory' ? '#7e22ce' : (res.statusKey === 'main' ? '#10b981' : (res.statusKey === 'qual' ? '#eab308' : '#9ca3af'))}">
                                <label class="tournament-checkbox-label">
                                    <input type="checkbox" class="tournament-checkbox"
                                        :checked="selectedTournaments.includes(res.id)"
                                        @change="toggleTournamentSelection(res.id)"
                                        :disabled="!selectedTournaments.includes(res.id) && selectedTournaments.length >= 3">
                                    <span style="font-size:0.65rem; font-weight:600; color:var(--gray-600);">
                                        {{ selectedTournaments.includes(res.id) ? t('tournamentSelectedCheck') :
                                        t('selectForCircuit') }}
                                    </span>
                                </label>
                                <div class="flex-between mb-2">
                                    <div>
                                        <h4 style="font-size:0.875rem; font-weight:700;"><span class="res-grade">{{
                                                res.shortGrade }}</span> {{ res.name }}</h4>
                                        <span style="font-size:0.65rem; color:var(--gray-500);">{{ res.city }} | {{
                                            res.date
                                            }}</span>
                                    </div>
                                    <div style="text-align:right;">
                                        <span style="font-size:0.75rem; font-weight:700; display:block;"
                                            :style="{'color': res.statusKey === 'mandatory' ? '#7e22ce' : (res.statusKey === 'main' ? '#10b981' : '#6b7280')}">{{
                                            res.prediction }}</span>
                                        <div style="font-size:0.5rem; color:var(--gray-400); margin-top:2px;">
                                            <span>Entry:
                                                {{ res.entryDeadline }}</span><br><span>W/D: {{ res.wdDeadline }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid-2">
                                    <a :href="getSearchUrl('flight', res.city, res.startIso, res.endIso)"
                                        target="_blank" class="action-btn"><i class="fa-solid fa-plane"></i> {{
                                        t('flight') }}</a>
                                    <a :href="getSearchUrl('hotel', res.city, res.startIso, res.endIso)" target="_blank"
                                        class="action-btn"><i class="fa-solid fa-bed"></i> {{ t('hotel') }}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p
                        style="font-size:0.55rem; color:var(--gray-400); margin-top:1rem; text-align:center; line-height:1.4;">
                        {{ t('disclaimer') }}</p>
                </div>

                <!-- ‚úÖ NEW: Safety Warning Footer -->
                <div class="safety-warning-footer">
                    <p class="safety-warning-text">
                        <i class="fa-solid fa-triangle-exclamation safety-warning-icon"></i>
                        {{ t('safetyWarning') }}
                    </p>
                </div>

                <footer class="p-6 text-center"
                    style="background:var(--gray-50); border-top:1px solid var(--gray-200); margin-top:2rem;">
                    <p style="font-size:0.75rem; color:var(--primary); margin-bottom:0.5rem; font-weight:600;">More
                        useful features are coming soon.</p>
                    <h4 style="font-weight:700; font-size:0.875rem; color:var(--slate-700); margin-bottom:0.5rem;">ROUM
                        S & E Co., Ltd.</h4>
                    <p style="font-size:0.65rem; color:var(--gray-500); line-height:1.6;">#117, 201 Hyangdong-ro,
                        Deogyang-gu, Goyang-si, Gyeonggi-do, Rep. of Korea<br>
                        <span @click="copyEmail"
                            style="cursor:pointer; color:var(--primary); text-decoration:underline;"
                            title="Click to copy email">roumsne@gmail.com</span><br>
                        Copyright ¬© 2026 ROUM S & E. All rights reserved.<br>
                        <span style="font-size:0.5rem; color:var(--gray-400);">v2.1.1 (Data: 2026-02-11)</span>
                    </p>
                </footer>
            </div>
        </div>

        <!-- ‚úÖ NEW: Plan Circuit Button (shown when 2-3 tournaments selected) -->
        <button v-if="selectedTournaments.length >= 2 && selectedTournaments.length <= 3 && sim.results"
            @click="planCircuit" class="btn btn-emerald plan-circuit-btn" aria-label="Plan circuit">
            <i class="fa-solid fa-route"></i> {{ t('planCircuit') }} ({{ selectedTournaments.length }} {{
            t('tournamentSelected') }})
        </button>

        <button v-if="sim.results" @click="shareResults" class="share-sticky-btn" aria-label="Share results">
            <i class="fa-solid fa-share-nodes"></i>
        </button>

        <div v-if="showConsultModal" class="modal-overlay" @click.self="showConsultModal=false">
            <div class="card animate-fade-in" style="width:100%; max-width:320px; text-align:center; padding: 2rem;">
                <h3 style="margin-bottom:1rem; font-weight:800; font-size: 1.25rem;">{{ t('consultTitle') }}</h3>

                <p
                    style="font-size: 0.9rem; line-height: 1.6; color: var(--slate-700); margin-bottom: 1.5rem; word-break: keep-all;">
                    If you have any inquiries regarding your badminton career, please contact me directly. I am a
                    professional badminton agent.<br><br>
                    <strong>I am a real person.</strong>
                </p>

                <div @click="copyAgentEmail" class="email-box"
                    style="background: var(--gray-50); border: 1px solid var(--gray-200); padding: 1rem; border-radius: 0.75rem; cursor: pointer; transition: all 0.2s;">
                    <i class="fa-regular fa-envelope"
                        style="color: var(--primary); font-size: 1.25rem; margin-bottom: 0.5rem; display: block;"></i>
                    <span style="font-weight: 700; color: var(--slate-800); font-size: 1rem;">withm2k@gmail.com</span>
                    <p style="font-size: 0.65rem; color: var(--gray-500); margin-top: 0.25rem;">(Click to copy)</p>
                </div>

                <button class="btn btn-ghost mt-6" @click="showConsultModal=false">{{ t('close') }}</button>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive, computed, watch, onMounted } = Vue;

        // ‚úÖ ÏàòÏ†ï: Îã§Íµ≠Ïñ¥ Î©îÏãúÏßÄ Ï∂îÍ∞Ä
        const i18nData = {
            en: {
                searchTitle: 'Search Player', searchPlaceholder: 'Search by Name or BWF ID', searchClear: 'Clear',
                noPlayersFound: 'No players found',
                dataLoadError: 'Failed to load player data. Please check if rankings_data.js exists.',
                simTitle: 'Entry Simulator', simSingles: 'Singles', simDoubles: 'Doubles',
                playerInfo: 'Player Info', rankPoints: 'Rank Points (e.g. 25000)', currentRank: 'Current Rank (e.g. 8)',
                partnerPoints: 'Partner Points',
                partnerPointsPlaceholder: 'Partner Points (optional)',
                partnerPointsHint: 'If you select a doubles player, points will be auto-filled. You can also enter manually.',
                optional: 'Optional',
                simCalcMethod: 'Calculation Method',
                normal: 'Normal', normalDesc: 'My Points + Partner Points',
                notional: 'Notional Point', notionalDesc: '80% of Higher Points',
                adjusted: 'Adjusted Point',
                simOpt5: '1~5 Tournaments (x 2.0)', simOpt6: '6 Tournaments (x 1.66)', simOpt7: '7 Tournaments (x 1.42)', simOpt8: '8 Tournaments (x 1.25)',
                simBtnRun: 'Analyze Entry', simAnalyzing: 'Analyzing...', simResultTitle: 'Forecast List',
                flight: 'Flight', hotel: 'Hotel', disclaimer: '* Disclaimer: Simulation results are for reference only.',
                footerCalendar: 'BWF Calendar', footerConsult: 'Consult',
                consultTitle: 'Consultation Chat', close: 'Close',
                mandatory: 'Mandatory', mainSafe: 'Main Draw (Safe)', qualMain: 'Qualifying / Main Draw', promoProbable: 'Promotion Probable', reserve: 'Reserve',
                alertEnterPoints: 'Please enter points.',
                alertInvalidPoints: 'Please enter valid points (0-999,999).',
                alertInvalidRank: 'Please enter valid rank (1-100,000).',
                alertPartnerPoints: 'Please enter partner points for doubles.',
                fillRequiredFields: 'Please fill in all required fields',
                msgEnterPoints: 'Please enter ranking points',
                msgEnterPartnerPoints: 'Please enter partner points for doubles',
                simNotionalTitle: 'Notional Point',
                simNotionalDetail: '80% of the higher player\'s points',
                simAdjustedTitle: 'Adjusted Point',
                filterRegion: 'Region', filterGrade: 'Tournament Grade', filterAll: 'All',
                regionAsia: 'Asia', regionEurope: 'Europe', regionPanAm: 'Pan Am', regionAfrica: 'Africa', regionOceania: 'Oceania',
                timerEstimate: 'Estimated Time', timerSeconds: 'seconds',
                playerAdvice: 'üö´ Say NO to illegal gambling & drugs. Report it!',
                selectTournaments: 'Select 2-3 tournaments', planCircuit: 'Plan Circuit', tournamentSelected: 'selected',
                selectForCircuit: 'Select for Circuit', tournamentSelectedCheck: '‚úì Selected',
                checkboxInstructions: 'Check the box and search full journey.',
                selectForCircuit: 'Select for Circuit', tournamentSelectedCheck: '‚úì Selected',
                checkboxInstructions: 'Check the box and search full journey.',
                safetyWarning: 'üö´ Say NO to illegal gambling & drugs. Report it!',
                searchRememberMe: 'Remember Me'
            },
            ko: {
                searchTitle: 'ÏÑ†Ïàò Í≤ÄÏÉâ', searchPlaceholder: 'Ïù¥Î¶Ñ ÎòêÎäî BWF IDÎ°ú Í≤ÄÏÉâ', searchClear: 'ÏßÄÏö∞Í∏∞',
                noPlayersFound: 'ÏÑ†ÏàòÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§',
                dataLoadError: 'ÏÑ†Ïàò Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§. rankings_data.js ÌååÏùºÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.',
                simTitle: 'ÎåÄÌöå Ï∞∏Í∞Ä ÏãúÎÆ¨Î†àÏù¥ÌÑ∞', simSingles: 'Îã®Ïãù (Singles)', simDoubles: 'Î≥µÏãù (Doubles)',
                playerInfo: 'ÏÑ†Ïàò Ï†ïÎ≥¥ (Player Info)', rankPoints: 'Îû≠ÌÇπ Ìè¨Ïù∏Ìä∏ (Ïòà: 25000)', currentRank: 'ÌòÑÏû¨ Îû≠ÌÇπ (Ïòà: 8)',
                partnerPoints: 'ÌååÌä∏ÎÑà Ìè¨Ïù∏Ìä∏',
                partnerPointsPlaceholder: 'ÌååÌä∏ÎÑà Ìè¨Ïù∏Ìä∏ (ÏÑ†ÌÉùÏÇ¨Ìï≠)',
                partnerPointsHint: 'Î≥µÏãù ÏÑ†ÏàòÎ•º ÏÑ†ÌÉùÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú ÏûÖÎ†•Îê©ÎãàÎã§. ÏßÅÏ†ë ÏûÖÎ†•ÎèÑ Í∞ÄÎä•Ìï©ÎãàÎã§.',
                optional: 'ÏÑ†ÌÉùÏÇ¨Ìï≠',
                simCalcMethod: 'Ìè¨Ïù∏Ìä∏ ÏÇ∞Ï†ï Î∞©Ïãù (GCR 11.7)',
                normal: 'ÏùºÎ∞ò (Normal)', normalDesc: 'ÎÇ¥ Ìè¨Ïù∏Ìä∏ + ÌååÌä∏ÎÑà Ìè¨Ïù∏Ìä∏',
                notional: 'Í∞ÄÏÉÅ Ìè¨Ïù∏Ìä∏ (Notional Point)', notionalDesc: 'ÎÜíÏùÄ Ï™Ω Ìè¨Ïù∏Ìä∏Ïùò 80%',
                adjusted: 'Î≥¥Ï†ï Ìè¨Ïù∏Ìä∏ (Adjusted Point)',
                simOpt5: '1~5Í∞ú ÎåÄÌöå Ï∞∏Í∞Ä (x 2.0)', simOpt6: '6Í∞ú ÎåÄÌöå Ï∞∏Í∞Ä (x 1.66)', simOpt7: '7Í∞ú ÎåÄÌöå Ï∞∏Í∞Ä (x 1.42)', simOpt8: '8Í∞ú ÎåÄÌöå Ï∞∏Í∞Ä (x 1.25)',
                simBtnRun: 'Ï∞∏Í∞Ä Í∞ÄÎä• ÎåÄÌöå Î∂ÑÏÑù ÏãúÏûë', simAnalyzing: '3ÎÖÑÏπò Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Ï§ë...', simResultTitle: '2026 Ï∞∏Í∞Ä ÏòàÏÉÅ Î¶¨Ïä§Ìä∏',
                flight: 'Ìï≠Í≥µÍ∂å', hotel: 'Ìò∏ÌÖî', disclaimer: '* Î©¥Ï±Ö Ï°∞Ìï≠: ÏãúÎÆ¨Î†àÏù¥ÏÖò Í≤∞Í≥ºÎäî Ï∞∏Í≥†Ïö©ÏûÖÎãàÎã§.',
                footerCalendar: 'BWF Ï∫òÎ¶∞Îçî', footerConsult: 'ÏÉÅÎã¥ÌïòÍ∏∞',
                consultTitle: 'ÏÉÅÎã¥ Ï±ÑÎÑê', close: 'Îã´Í∏∞',
                mandatory: 'ÏùòÎ¨¥ Ï∞∏Í∞Ä (Top 10)', mainSafe: 'Î≥∏ÏÑ† ÏïàÏ†ïÍ∂å', qualMain: 'ÏòàÏÑ† ÏïàÏ†ïÍ∂å / Î≥∏ÏÑ† Í∞ÄÎä•', promoProbable: 'ÌîÑÎ°úÎ™®ÏÖò Ïú†Î†• (ÎåÄÍ∏∞ 1~5)', reserve: 'ÎåÄÍ∏∞',
                alertEnterPoints: 'Ìè¨Ïù∏Ìä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                alertInvalidPoints: 'Ïú†Ìö®Ìïú Ìè¨Ïù∏Ìä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî (0-999,999).',
                alertInvalidRank: 'Ïú†Ìö®Ìïú Îû≠ÌÇπÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî (1-100,000).',
                alertPartnerPoints: 'Î≥µÏãùÏùò Í≤ΩÏö∞ ÌååÌä∏ÎÑà Ìè¨Ïù∏Ìä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.',
                fillRequiredFields: 'ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî',
                msgEnterPoints: 'Îû≠ÌÇπ Ìè¨Ïù∏Ìä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî',
                msgEnterPartnerPoints: 'Î≥µÏãùÏùò Í≤ΩÏö∞ ÌååÌä∏ÎÑà Ìè¨Ïù∏Ìä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî',
                simNotionalTitle: 'Í∞ÄÏÉÅ Ìè¨Ïù∏Ìä∏ (Notional Point)',
                simNotionalDetail: 'Îëê ÏÑ†Ïàò Ï§ë ÎÜíÏùÄ Ìè¨Ïù∏Ìä∏Ïùò 80% Ï†ÅÏö©',
                simAdjustedTitle: 'Î≥¥Ï†ï Ìè¨Ïù∏Ìä∏ (Adjusted Point)',
                filterRegion: 'ÏßÄÏó≠', filterGrade: 'ÎåÄÌöå Îì±Í∏â', filterAll: 'Ï†ÑÏ≤¥',
                regionAsia: 'ÏïÑÏãúÏïÑ', regionEurope: 'Ïú†ÎüΩ', regionPanAm: 'Ìå¨Ïïî', regionAfrica: 'ÏïÑÌîÑÎ¶¨Ïπ¥', regionOceania: 'Ïò§ÏÑ∏ÏïÑÎãàÏïÑ',
                timerEstimate: 'ÏòàÏÉÅ ÏÜåÏöî ÏãúÍ∞Ñ', timerSeconds: 'Ï¥à',
                playerAdvice: 'üö´ Î∂àÎ≤ï ÎèÑÎ∞ï¬∑ÏïΩÎ¨º Ï†úÏïà Ï¶âÏãú Ïã†Í≥†!',
                selectTournaments: '2-3Í∞ú ÎåÄÌöå ÏÑ†ÌÉù', planCircuit: 'Ìà¨Ïñ¥ Í≥ÑÌöçÌïòÍ∏∞', tournamentSelected: 'Í∞ú ÏÑ†ÌÉùÎê®',
                selectForCircuit: 'ÏÑúÌÇ∑ ÏÑ†ÌÉù', tournamentSelectedCheck: '‚úì ÏÑ†ÌÉùÎê®',
                checkboxInstructions: 'Ï≤¥ÌÅ¨Î∞ïÏä§Î•º ÏÑ†ÌÉùÌïòÍ≥† Ï†ÑÏ≤¥ Ïó¨Ï†ïÏùÑ Í≤ÄÏÉâÌïòÏÑ∏Ïöî.',
                selectForCircuit: 'ÏÑúÌÇ∑ ÏÑ†ÌÉù', tournamentSelectedCheck: '‚úì ÏÑ†ÌÉùÎê®',
                checkboxInstructions: 'Ï≤¥ÌÅ¨Î∞ïÏä§Î•º ÏÑ†ÌÉùÌïòÍ≥† Ï†ÑÏ≤¥ Ïó¨Ï†ïÏùÑ Í≤ÄÏÉâÌïòÏÑ∏Ïöî.',
                safetyWarning: 'üö´ Î∂àÎ≤ï ÎèÑÎ∞ï¬∑ÏïΩÎ¨º Ï†úÏïà Ï¶âÏãú Ïã†Í≥†!',
                searchRememberMe: 'ÏÑ†Ïàò Í∏∞ÏñµÌïòÍ∏∞'
            },
            zh: {
                searchTitle: 'ÊêúÁ¥¢ÁêÉÂëò', searchPlaceholder: 'ÊåâÂßìÂêçÊàñ BWF ID ÊêúÁ¥¢', searchClear: 'Ê∏ÖÈô§',
                noPlayersFound: 'Êú™ÊâæÂà∞ÁêÉÂëò',
                dataLoadError: 'Êó†Ê≥ïÂä†ËΩΩÁêÉÂëòÊï∞ÊçÆ„ÄÇËØ∑Ê£ÄÊü• rankings_data.js Êñá‰ª∂„ÄÇ',
                simTitle: 'ÂèÇËµõÊ®°ÊãüÂô®', simSingles: 'ÂçïÊâì (Singles)', simDoubles: 'ÂèåÊâì (Doubles)',
                playerInfo: 'ÁêÉÂëò‰ø°ÊÅØ (Player Info)', rankPoints: 'ÊéíÂêçÁßØÂàÜ (‰æã: 25000)', currentRank: 'ÂΩìÂâçÊéíÂêç (‰æã: 8)',
                partnerPoints: 'Êê≠Ê°£ÁßØÂàÜ',
                partnerPointsPlaceholder: 'Êê≠Ê°£ÁßØÂàÜ (ÂèØÈÄâ)',
                partnerPointsHint: 'ÈÄâÊã©ÂèåÊâìÁêÉÂëòÂêé‰ºöËá™Âä®Â°´ÂÖÖ„ÄÇ‰πüÂèØ‰ª•ÊâãÂä®ËæìÂÖ•„ÄÇ',
                optional: 'ÂèØÈÄâ',
                simCalcMethod: 'ÁßØÂàÜËÆ°ÁÆóÊñπÂºè (GCR 11.7)',
                normal: 'ÊôÆÈÄö (Normal)', normalDesc: 'ÊàëÁöÑÁßØÂàÜ + Êê≠Ê°£ÁßØÂàÜ',
                notional: 'ËôöÊãüÁßØÂàÜ (Notional Point)', notionalDesc: 'ËæÉÈ´òÁßØÂàÜÁöÑ 80%',
                adjusted: 'Ë∞ÉÊï¥ÁßØÂàÜ (Adjusted Point)',
                simOpt5: 'ÂèÇÂä† 1~5 ‰∏™ÊØîËµõ (x 2.0)', simOpt6: 'ÂèÇÂä† 6 ‰∏™ÊØîËµõ (x 1.66)', simOpt7: 'ÂèÇÂä† 7 ‰∏™ÊØîËµõ (x 1.42)', simOpt8: 'ÂèÇÂä† 8 ‰∏™ÊØîËµõ (x 1.25)',
                simBtnRun: 'ÂºÄÂßãÂàÜÊûêÂèÇËµõËµÑÊ†º', simAnalyzing: 'Ê≠£Âú®ÂàÜÊûê...', simResultTitle: '2026 ÂèÇËµõÈ¢ÑÊµãÂàóË°®',
                flight: 'Êú∫Á•®', hotel: 'ÈÖíÂ∫ó', disclaimer: '* ÂÖçË¥£Â£∞ÊòéÔºöÊ®°ÊãüÁªìÊûú‰ªÖ‰æõÂèÇËÄÉ„ÄÇ',
                footerCalendar: 'BWF Êó•ÂéÜ', footerConsult: 'Âí®ËØ¢',
                consultTitle: 'Âí®ËØ¢ËÅäÂ§©', close: 'ÂÖ≥Èó≠',
                mandatory: 'Âº∫Âà∂ÂèÇËµõ (Top 10)', mainSafe: 'Ê≠£ËµõÂúà (ÂÆâÂÖ®)', qualMain: 'ËµÑÊ†ºËµõ / Ê≠£ËµõÂèØËÉΩ', promoProbable: 'ÂæàÊúâÂèØËÉΩÊôãÁ∫ß (ÂÄôË°• 1~5)', reserve: 'ÂÄôË°•',
                alertEnterPoints: 'ËØ∑ËæìÂÖ•ÁßØÂàÜ„ÄÇ',
                alertInvalidPoints: 'ËØ∑ËæìÂÖ•ÊúâÊïàÁßØÂàÜ (0-999,999)„ÄÇ',
                alertInvalidRank: 'ËØ∑ËæìÂÖ•ÊúâÊïàÊéíÂêç (1-100,000)„ÄÇ',
                alertPartnerPoints: 'ÂèåÊâìËØ∑ËæìÂÖ•Êê≠Ê°£ÁßØÂàÜ„ÄÇ',
                fillRequiredFields: 'ËØ∑Â°´ÂÜôÊâÄÊúâÂøÖÂ°´È°π',
                msgEnterPoints: 'ËØ∑ËæìÂÖ•ÊéíÂêçÁßØÂàÜ',
                msgEnterPartnerPoints: 'ÂèåÊâìËØ∑ËæìÂÖ•Êê≠Ê°£ÁßØÂàÜ',
                simNotionalTitle: 'ËôöÊãüÁßØÂàÜ (Notional Point)',
                simNotionalDetail: 'ËæÉÈ´òÁêÉÂëòÁßØÂàÜÁöÑ 80%',
                simAdjustedTitle: 'Ë∞ÉÊï¥ÁßØÂàÜ (Adjusted Point)',
                filterRegion: 'Âú∞Âå∫', filterGrade: 'ÊØîËµõÁ≠âÁ∫ß', filterAll: 'ÂÖ®ÈÉ®',
                regionAsia: '‰∫öÊ¥≤', regionEurope: 'Ê¨ßÊ¥≤', regionPanAm: 'Ê≥õÁæé', regionAfrica: 'ÈùûÊ¥≤', regionOceania: 'Â§ßÊ¥ãÊ¥≤',
                timerEstimate: 'È¢ÑËÆ°Êó∂Èó¥', timerSeconds: 'Áßí',
                playerAdvice: 'üö´ ÊãíÁªùËµåÂçöÂíåÊØíÂìÅ¬∑Á´ãÂç≥‰∏æÊä•ÔºÅ',
                selectTournaments: 'ÈÄâÊã© 2-3 ‰∏™ÊØîËµõ', planCircuit: 'ËßÑÂàíÂ∑°ÂõûËµõ', tournamentSelected: 'Â∑≤ÈÄâÊã©',
                selectForCircuit: 'ÈÄâÊã©Â∑°ÂõûËµõ', tournamentSelectedCheck: '‚úì Â∑≤ÈÄâÊã©',
                checkboxInstructions: 'ÈÄâ‰∏≠Â§çÈÄâÊ°ÜÂπ∂ÊêúÁ¥¢ÂÆåÊï¥Ë°åÁ®ã„ÄÇ',
                selectForCircuit: 'ÈÄâÊã©Â∑°ÂõûËµõ', tournamentSelectedCheck: '‚úì Â∑≤ÈÄâÊã©',
                checkboxInstructions: 'ÈÄâ‰∏≠Â§çÈÄâÊ°ÜÂπ∂ÊêúÁ¥¢ÂÆåÊï¥Ë°åÁ®ã„ÄÇ',
                safetyWarning: 'üö´ ÊãíÁªùËµåÂçöÂíåÊØíÂìÅ¬∑Á´ãÂç≥‰∏æÊä•ÔºÅ',
                searchRememberMe: 'ËÆ∞‰ΩèÊàë'
            },
            ja: {
                searchTitle: 'ÈÅ∏ÊâãÊ§úÁ¥¢', searchPlaceholder: 'ÂêçÂâç„Åæ„Åü„ÅØBWF ID„ÅßÊ§úÁ¥¢', searchClear: '„ÇØ„É™„Ç¢',
                noPlayersFound: 'ÈÅ∏Êâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì',
                dataLoadError: 'ÈÅ∏Êâã„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇrankings_data.js „Éï„Ç°„Ç§„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                simTitle: 'Â§ß‰ºöÂèÇÂä†„Ç∑„Éü„É•„É¨„Éº„Çø„Éº', simSingles: '„Ç∑„É≥„Ç∞„É´„Çπ (Singles)', simDoubles: '„ÉÄ„Éñ„É´„Çπ (Doubles)',
                playerInfo: 'ÈÅ∏ÊâãÊÉÖÂ†± (Player Info)', rankPoints: '„É©„É≥„Ç≠„É≥„Ç∞„Éù„Ç§„É≥„Éà (‰æã: 25000)', currentRank: 'ÁèæÂú®„ÅÆÈ†Ü‰Ωç (‰æã: 8)',
                partnerPoints: '„Éë„Éº„Éà„Éä„Éº„Éù„Ç§„É≥„Éà',
                partnerPointsPlaceholder: '„Éë„Éº„Éà„Éä„Éº„Éù„Ç§„É≥„Éà („Ç™„Éó„Ç∑„Éß„É≥)',
                partnerPointsHint: '„ÉÄ„Éñ„É´„ÇπÈÅ∏Êâã„ÇíÈÅ∏Êäû„Åô„Çã„Å®Ëá™ÂãïÂÖ•Âäõ„Åï„Çå„Åæ„Åô„ÄÇÊâãÂãïÂÖ•Âäõ„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇ',
                optional: '„Ç™„Éó„Ç∑„Éß„É≥',
                simCalcMethod: '„Éù„Ç§„É≥„ÉàË®àÁÆóÊñπÊ≥ï (GCR 11.7)',
                normal: 'ÈÄöÂ∏∏ (Normal)', normalDesc: 'Ëá™ÂàÜ„ÅÆ„Éù„Ç§„É≥„Éà + „Éë„Éº„Éà„Éä„Éº„Éù„Ç§„É≥„Éà',
                notional: '„Åø„Å™„Åó„Éù„Ç§„É≥„Éà (Notional Point)', notionalDesc: 'È´ò„ÅÑÊñπ„ÅÆ„Éù„Ç§„É≥„Éà„ÅÆ80%',
                adjusted: 'Ë™øÊï¥„Éù„Ç§„É≥„Éà (Adjusted Point)',
                simOpt5: '1~5Â§ß‰ºöÂèÇÂä† (x 2.0)', simOpt6: '6Â§ß‰ºöÂèÇÂä† (x 1.66)', simOpt7: '7Â§ß‰ºöÂèÇÂä† (x 1.42)', simOpt8: '8Â§ß‰ºöÂèÇÂä† (x 1.25)',
                simBtnRun: 'ÂèÇÂä†ÂèØËÉΩÊÄß„ÇíÂàÜÊûê', simAnalyzing: 'ÂàÜÊûê‰∏≠...', simResultTitle: '2026 ÂèÇÂä†‰∫àÊÉ≥„É™„Çπ„Éà',
                flight: 'Ëà™Á©∫Âà∏', hotel: '„Éõ„ÉÜ„É´', disclaimer: '* ÂÖçË≤¨‰∫ãÈ†ÖÔºö„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÁµêÊûú„ÅØÂèÇËÄÉÁî®„Åß„Åô„ÄÇ',
                footerCalendar: 'BWF„Ç´„É¨„É≥„ÉÄ„Éº', footerConsult: 'Áõ∏Ë´á„Åô„Çã',
                consultTitle: 'Áõ∏Ë´á„ÉÅ„É£„ÉÉ„Éà', close: 'Èñâ„Åò„Çã',
                mandatory: 'Áæ©ÂãôÂèÇÂä† (Top 10)', mainSafe: 'Êú¨Êà¶ÂúèÂÜÖ', qualMain: '‰∫àÈÅ∏ÂúèÂÜÖ / Êú¨Êà¶ÂèØËÉΩ', promoProbable: 'ÊòáÊ†ºÊúâÂäõ (Ë£úÊ¨† 1~5)', reserve: 'Ë£úÊ¨†',
                alertEnterPoints: '„Éù„Ç§„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                alertInvalidPoints: 'ÊúâÂäπ„Å™„Éù„Ç§„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ (0-999,999)„ÄÇ',
                alertInvalidRank: 'ÊúâÂäπ„Å™È†Ü‰Ωç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ (1-100,000)„ÄÇ',
                alertPartnerPoints: '„ÉÄ„Éñ„É´„Çπ„ÅÆÂ†¥Âêà„ÅØ„Éë„Éº„Éà„Éä„Éº„Éù„Ç§„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                fillRequiredFields: 'ÂøÖÈ†àÈ†ÖÁõÆ„Çí„Åô„Åπ„Å¶ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                msgEnterPoints: '„É©„É≥„Ç≠„É≥„Ç∞„Éù„Ç§„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                msgEnterPartnerPoints: '„ÉÄ„Éñ„É´„Çπ„ÅÆÂ†¥Âêà„ÅØ„Éë„Éº„Éà„Éä„Éº„Éù„Ç§„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                simNotionalTitle: '„Åø„Å™„Åó„Éù„Ç§„É≥„Éà (Notional Point)',
                simNotionalDetail: 'È´ò„ÅÑÊñπ„ÅÆÈÅ∏Êâã„ÅÆ„Éù„Ç§„É≥„Éà„ÅÆ80%',
                simAdjustedTitle: 'Ë™øÊï¥„Éù„Ç§„É≥„Éà (Adjusted Point)',
                filterRegion: 'Âú∞Âüü', filterGrade: 'Â§ß‰ºö„Ç∞„É¨„Éº„Éâ', filterAll: '„Åô„Åπ„Å¶',
                regionAsia: '„Ç¢„Ç∏„Ç¢', regionEurope: '„É®„Éº„É≠„ÉÉ„Éë', regionPanAm: '„Éë„É≥„Ç¢„É°„É™„Ç´', regionAfrica: '„Ç¢„Éï„É™„Ç´', regionOceania: '„Ç™„Çª„Ç¢„Éã„Ç¢',
                timerEstimate: '‰∫àÊÉ≥ÊôÇÈñì', timerSeconds: 'Áßí',
                playerAdvice: 'üö´ Ë≥≠Âçö„ÉªËñ¨Áâ©„ÅØÊãíÂê¶ÔºÅÂç≥ÈÄöÂ†±ÔºÅ',
                selectTournaments: '2-3Â§ß‰ºöÈÅ∏Êäû', planCircuit: '„ÉÑ„Ç¢„ÉºË®àÁîª', tournamentSelected: 'ÈÅ∏ÊäûÊ∏à„Åø',
                selectForCircuit: '„Çµ„Éº„Ç≠„ÉÉ„ÉàÈÅ∏Êäû', tournamentSelectedCheck: '‚úì ÈÅ∏ÊäûÊ∏à„Åø',
                checkboxInstructions: '„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„ÄÅÂÆåÂÖ®„Å™ÊóÖÁ®ã„ÇíÊ§úÁ¥¢„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                selectForCircuit: '„Çµ„Éº„Ç≠„ÉÉ„ÉàÈÅ∏Êäû', tournamentSelectedCheck: '‚úì ÈÅ∏ÊäûÊ∏à„Åø',
                checkboxInstructions: '„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„ÄÅÂÆåÂÖ®„Å™ÊóÖÁ®ã„ÇíÊ§úÁ¥¢„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                safetyWarning: 'üö´ Ë≥≠Âçö„ÉªËñ¨Áâ©„ÅØÊãíÂê¶ÔºÅÂç≥ÈÄöÂ†±ÔºÅ',
                searchRememberMe: 'Ê§úÁ¥¢„Åó„ÅüÈÅ∏Êâã„ÇíË®òÊÜ∂„Åô„Çã'
            }
        };

        createApp({
            setup() {
                // Load saved language or default to 'en'
                const savedLang = localStorage.getItem('courtmate_lang');
                const currentLang = ref(savedLang || 'en');
                const rememberPlayer = ref(false); // ‚úÖ NEW: Remember Me State

                const showConsultModal = ref(false);
                const searchQuery = ref('');
                const showSearchResults = ref(false);
                const dataLoadError = ref(false);
                const darkMode = ref(false);
                const validationErrors = reactive({
                    points: '',
                    rank: '',
                    partnerPoints: ''
                });

                // ‚úÖ NEW: Tournament Filters
                const filters = reactive({
                    selectedRegions: [],
                    selectedGrades: []
                });

                // ‚úÖ NEW: Timer State
                const timerState = reactive({
                    countdown: 0,
                    intervalId: null
                });

                // ‚úÖ NEW: Loading Logs State
                const loadingLogs = ref([
                    { message: 'DB Searching...', done: false },
                    { message: 'Parsing Week 7 Rankings...', done: false },
                    { message: 'Loading 2026 Calendar...', done: false },
                    { message: 'Analyzing Tournament Data...', done: false },
                    { message: 'Preparing Smart Recommendations...', done: false }
                ]);
                const loadingProgress = ref(0);

                // ‚úÖ NEW: Multi-Tournament Selection
                const selectedTournaments = ref([]);
                const playerNationality = ref('');  // Based on player country

                // ‚úÖ ÏàòÏ†ï: rankings_data.js Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÌôïÏù∏
                const rankingsDataRaw = window.RANKINGS_2026_RAW || {};

                // ‚úÖ Ï∂îÍ∞Ä: Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÌôïÏù∏
                if (!window.RANKINGS_2026_RAW || Object.keys(window.RANKINGS_2026_RAW).length === 0) {
                    dataLoadError.value = true;
                    console.error('‚ö†Ô∏è RANKINGS_2026_RAW data not found. Please ensure rankings_data.js is loaded.');
                }

                // ‚úÖ ÏàòÏ†ï: ÏÑ†Ïàò Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ Í∞úÏÑ†
                const allPlayers = computed(() => {
                    let players = [];
                    for (const [cat, list] of Object.entries(rankingsDataRaw)) {
                        if (Array.isArray(list)) {
                            list.forEach(p => {
                                players.push({
                                    ...p,
                                    category: cat,
                                    // player ÌïÑÎìúÎ•º nameÏúºÎ°úÎèÑ ÏÇ¨Ïö© Í∞ÄÎä•ÌïòÎèÑÎ°ù
                                    name: p.name || p.player,
                                    id: p.id || p.member_id,
                                    // pointsÎ•º Ïà´ÏûêÎ°ú Î≥ÄÌôò (ÏâºÌëú Ï†úÍ±∞)
                                    numericPoints: typeof p.points === 'string' ?
                                        (parseInt(p.points.replace(/,/g, '')) || 0) :
                                        (p.points || 0)
                                });
                            });
                        }
                    }
                    return players;
                });

                // ‚úÖ ÏàòÏ†ï: Í≤ÄÏÉâ ÏïåÍ≥†Î¶¨Ï¶ò Í∞úÏÑ†
                const searchResults = computed(() => {
                    if (!searchQuery.value) return [];
                    const q = searchQuery.value.toLowerCase().trim();

                    return allPlayers.value.filter(p => {
                        const nameMatch = p.name && p.name.toLowerCase().includes(q);
                        const countryMatch = p.country && p.country.toLowerCase().includes(q);
                        const categoryMatch = p.category && p.category.toLowerCase().includes(q);
                        const idMatch = p.id && p.id.toString().includes(q);
                        const rankMatch = p.rank && p.rank.toString() === q;

                        return nameMatch || countryMatch || categoryMatch || idMatch || rankMatch;
                    })
                        .sort((a, b) => {
                            // Îû≠ÌÇπ ÏàúÏúºÎ°ú Ï†ïÎ†¨
                            return parseInt(a.rank) - parseInt(b.rank);
                        })
                        .slice(0, 20);
                });

                // ‚úÖ Ï∂îÍ∞Ä: Ìè¨Ïù∏Ìä∏ Ìè¨Îß∑ÌåÖ Ìï®Ïàò
                const formatPoints = (points) => {
                    if (typeof points === 'string') {
                        points = parseInt(points.replace(/,/g, ''));
                    }
                    return points.toLocaleString();
                };

                // ‚úÖ ÏàòÏ†ï: ÏÑ†Ïàò ÏÑ†ÌÉù Ìï®Ïàò Í∞úÏÑ†
                const selectPlayer = (p) => {
                    // points Í∞í Ï†ïÍ∑úÌôî (Î¨∏ÏûêÏó¥ ÎòêÎäî Ïà´Ïûê Î™®Îëê Ï≤òÎ¶¨)
                    const totalPoints = typeof p.points === 'string' ?
                        parseInt(p.points.replace(/,/g, '')) :
                        parseInt(p.points);

                    sim.currentRank = parseInt(p.rank);
                    sim.guestEvent = p.category;
                    sim.type = (p.category === 'MD' || p.category === 'WD' || p.category === 'XD') ? 'doubles' : 'singles';

                    // ‚úÖ Ï∂îÍ∞Ä: Î≥µÏãùÏùº Í≤ΩÏö∞ Í∞Å ÏÑ†ÏàòÏùò Í∞úÎ≥Ñ Ìè¨Ïù∏Ìä∏Î•º Ï∞æÏïÑÏÑú ÏÑ§Ï†ï
                    if (sim.type === 'doubles') {
                        // Î≥µÏãù ÏÑ†Ïàò Ïù¥Î¶ÑÍ≥º IDÏóêÏÑú Í∞úÎ≥Ñ ÏÑ†Ïàò Ï†ïÎ≥¥ Ï∂îÏ∂ú
                        const playerName = p.name || p.player;
                        const playerId = p.id || p.member_id;
                        const names = playerName.split(' / ');
                        const ids = playerId.split(' / ');

                        // Í∞Å ÏÑ†ÏàòÏùò Îã®Ïãù Ìè¨Ïù∏Ìä∏Î•º Ï∞æÍ∏∞
                        let player1Points = 0;
                        let player2Points = 0;

                        // ÏÑ†Ïàò1Ïùò Ìè¨Ïù∏Ìä∏ Ï∞æÍ∏∞ (MS ÎòêÎäî WSÏóêÏÑú)
                        const singlesCat = p.category === 'XD' ? null : (p.category === 'MD' ? 'MS' : 'WS');

                        if (singlesCat && rankingsDataRaw[singlesCat]) {
                            const player1 = rankingsDataRaw[singlesCat].find(pl => {
                                const plId = pl.id || pl.member_id;
                                return plId && ids[0] && plId.trim() === ids[0].trim();
                            });
                            if (player1) {
                                player1Points = typeof player1.points === 'string' ?
                                    parseInt(player1.points.replace(/,/g, '')) :
                                    parseInt(player1.points);
                            }

                            const player2 = rankingsDataRaw[singlesCat].find(pl => {
                                const plId = pl.id || pl.member_id;
                                return plId && ids[1] && plId.trim() === ids[1].trim();
                            });
                            if (player2) {
                                player2Points = typeof player2.points === 'string' ?
                                    parseInt(player2.points.replace(/,/g, '')) :
                                    parseInt(player2.points);
                            }
                        }

                        // XDÏùò Í≤ΩÏö∞ MSÏôÄ WS Î™®Îëê ÌôïÏù∏
                        if (p.category === 'XD') {
                            // Ï≤´ Î≤àÏß∏ ÏÑ†Ïàò (ÎÇ®Ïûê)
                            if (rankingsDataRaw['MS']) {
                                const player1 = rankingsDataRaw['MS'].find(pl => {
                                    const plId = pl.id || pl.member_id;
                                    return plId && ids[0] && plId.trim() === ids[0].trim();
                                });
                                if (player1) {
                                    player1Points = typeof player1.points === 'string' ?
                                        parseInt(player1.points.replace(/,/g, '')) :
                                        parseInt(player1.points);
                                }
                            }
                            // Îëê Î≤àÏß∏ ÏÑ†Ïàò (Ïó¨Ïûê)
                            if (rankingsDataRaw['WS']) {
                                const player2 = rankingsDataRaw['WS'].find(pl => {
                                    const plId = pl.id || pl.member_id;
                                    return plId && ids[1] && plId.trim() === ids[1].trim();
                                });
                                if (player2) {
                                    player2Points = typeof player2.points === 'string' ?
                                        parseInt(player2.points.replace(/,/g, '')) :
                                        parseInt(player2.points);
                                }
                            }
                        }

                        // Í∞úÎ≥Ñ Ìè¨Ïù∏Ìä∏Î•º Ï∞æÏïòÏúºÎ©¥ ÏÇ¨Ïö©, Î™ª Ï∞æÏïòÏúºÎ©¥ Î≥µÏãù Ìè¨Ïù∏Ìä∏Î•º Î∞òÏúºÎ°ú ÎÇòÎàî
                        if (player1Points > 0 || player2Points > 0) {
                            sim.guestPoints = player1Points || Math.floor(totalPoints / 2);
                            sim.partnerPoints = player2Points || Math.floor(totalPoints / 2);
                        } else {
                            // Í∞úÎ≥Ñ Ìè¨Ïù∏Ìä∏Î•º Ï∞æÏßÄ Î™ªÌïú Í≤ΩÏö∞ Î≥µÏãù Ìè¨Ïù∏Ìä∏Î•º Î∞òÏúºÎ°ú ÎÇòÎàî
                            sim.guestPoints = Math.floor(totalPoints / 2);
                            sim.partnerPoints = Math.floor(totalPoints / 2);
                        }
                    } else {
                        sim.guestPoints = totalPoints;
                        sim.partnerPoints = null;
                    }

                    if (rememberPlayer.value) {
                        // Save player info to localStorage
                        const playerToSave = {
                            ...p,
                            points: typeof p.points === 'string' ? p.points : p.points.toString()
                        };
                        localStorage.setItem('courtmate_saved_player', JSON.stringify(playerToSave));
                        localStorage.setItem('courtmate_remember_me', 'true');
                    } else {
                        // If unchecked, we might want to clear it, but maybe user just wants to switch temporarily?
                        // Let's clear it if they uncheck it explicitly to stop remembering.
                        // However, current flow is: search -> select.
                        // If they uncheck, they probably don't want to save *this* selection.
                        // But if they had a previous one saved, should we clear it?
                        // Let's go with: if rememberMe is false, we remove any saved player.
                        localStorage.removeItem('courtmate_saved_player');
                        localStorage.setItem('courtmate_remember_me', 'false');
                    }

                    clearSearch();
                    validateInputs();
                };

                // ‚úÖ Ï∂îÍ∞Ä: Í≤ÄÏÉâ Ï¥àÍ∏∞Ìôî Ìï®Ïàò
                const clearSearch = () => {
                    searchQuery.value = '';
                    showSearchResults.value = false;
                };

                const sim = reactive({
                    type: 'singles',
                    calcMethod: 'normal',
                    playedCount: '5',
                    partnerPoints: null,
                    guestEvent: 'MS',
                    guestPoints: null,
                    currentRank: null,
                    finalPoints: 0,
                    results: null,
                    loading: false
                });

                // ‚úÖ Ï∂îÍ∞Ä: ÏûÖÎ†• Ïú†Ìö®ÏÑ± Í≤ÄÏ¶ù
                const validateInputs = () => {
                    validationErrors.points = '';
                    validationErrors.rank = '';
                    validationErrors.partnerPoints = '';

                    if (sim.guestPoints !== null && (sim.guestPoints < 0 || sim.guestPoints > 999999)) {
                        validationErrors.points = t('alertInvalidPoints');
                    }

                    if (sim.currentRank !== null && (sim.currentRank < 1 || sim.currentRank > 100000)) {
                        validationErrors.rank = t('alertInvalidRank');
                    }

                    if (sim.type === 'doubles' && sim.partnerPoints !== null && (sim.partnerPoints < 0 || sim.partnerPoints > 999999)) {
                        validationErrors.partnerPoints = t('alertInvalidPoints');
                    }
                };

                // ‚úÖ Ï∂îÍ∞Ä: Ìèº Ïú†Ìö®ÏÑ± Ï≤¥ÌÅ¨
                const isFormValid = computed(() => {
                    // Í∏∞Î≥∏ Ìè¨Ïù∏Ìä∏ Ï≤¥ÌÅ¨
                    if (!sim.guestPoints || sim.guestPoints < 0 || sim.guestPoints > 999999) {
                        return false;
                    }

                    // Îû≠ÌÇπ Ï≤¥ÌÅ¨ (ÏÑ†ÌÉùÏÇ¨Ìï≠Ïù¥ÎØÄÎ°ú ÏûÖÎ†•ÌñàÏùÑ ÎïåÎßå Í≤ÄÏ¶ù)
                    if (sim.currentRank && (sim.currentRank < 1 || sim.currentRank > 100000)) {
                        return false;
                    }

                    // ‚úÖ ÏàòÏ†ï: Î≥µÏãùÏùº Îïå ÌååÌä∏ÎÑà Ìè¨Ïù∏Ìä∏Îäî ÏÑ†ÌÉùÏÇ¨Ìï≠ (ÏóÜÏúºÎ©¥ ÎÇ¥ Ìè¨Ïù∏Ìä∏Îßå ÏÇ¨Ïö©)
                    // ÏûÖÎ†•ÌñàÏùÑ Í≤ΩÏö∞ÏóêÎßå Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
                    if (sim.type === 'doubles' && sim.partnerPoints) {
                        if (sim.partnerPoints < 0 || sim.partnerPoints > 999999) {
                            return false;
                        }
                    }

                    return true;
                });

                // ‚úÖ NEW: Affiliate Marker ID
                const MARKER_ID = '497432'; // Derived from the provided script ID

                // ‚úÖ NEW: City Data for Deep Linking (Coordinates & Airport Codes)
                // ‚úÖ NEW: City Data for Deep Linking (Coordinates & Airport Codes)
                const CITY_DATA = {
                    // Super 1000
                    "Kuala Lumpur": { code: "KUL", lat: 3.0538, lng: 101.5369 },
                    "Birmingham": { code: "BHX", lat: 52.4796, lng: -1.9148 },
                    "Jakarta": { code: "CGK", lat: -6.2215, lng: 106.8016 },
                    "Changzhou": { code: "CZX", lat: 31.8659, lng: 119.9922 }, // Using CZX or NKG/PVG fallback?
                    "China": { code: "BJS", lat: 39.9042, lng: 116.4074 }, // Default for "China" if city not found
                    // Super 750
                    "New Delhi": { code: "DEL", lat: 28.5583, lng: 77.2435 },
                    "Singapore": { code: "SIN", lat: 1.2996, lng: 103.8745 },
                    "Tokyo": { code: "TYO", lat: 35.6644, lng: 139.7027 },
                    "Paris": { code: "PAR", lat: 48.8997, lng: 2.3615 },
                    "Odense": { code: "ODE", lat: 55.3917, lng: 10.3475 },
                    "Shenzhen": { code: "SZX", lat: 22.5607, lng: 113.8827 },
                    // Super 500
                    "Bangkok": { code: "BKK", lat: 13.7431, lng: 100.5284 },
                    "Sydney": { code: "SYD", lat: -33.8471, lng: 151.0634 },
                    "Calgary": { code: "YYC", lat: 51.0426, lng: -114.0620 },
                    "Seoul": { code: "SEL", lat: 37.5160, lng: 127.1246 },
                    "Hong Kong": { code: "HKG", lat: 22.3364, lng: 114.1824 },
                    "Vantaa": { code: "HEL", lat: 60.2934, lng: 24.8540 },
                    "Kumamoto": { code: "KMJ", lat: 32.7937, lng: 130.6976 },
                    // Super 300 & Others
                    "M√ºlheim an der Ruhr": { code: "DUS", lat: 51.4228, lng: 6.8920 },
                    "Mulheim": { code: "DUS", lat: 51.4228, lng: 6.8920 },
                    "Basel": { code: "BSL", lat: 47.5398, lng: 7.6167 },
                    "Madrid": { code: "MAD", lat: 40.4079, lng: -3.7153 },
                    "Orl√©ans": { code: "ORY", lat: 47.8864, lng: 1.9090 },
                    "Orleans": { code: "ORY", lat: 47.8864, lng: 1.9090 },
                    "Auckland": { code: "AKL", lat: -36.8049, lng: 174.7735 },
                    "Fort Worth": { code: "DFW", lat: 32.7473, lng: -97.3307 },
                    "Taipei": { code: "TPE", lat: 25.0504, lng: 121.5516 },
                    "Macau": { code: "MFM", lat: 22.1557, lng: 113.5606 },
                    "Saarbr√ºcken": { code: "SCN", lat: 49.2393, lng: 6.9777 },
                    "Iksan City": { code: "ICN", lat: 35.9458, lng: 126.9602 },
                    "Lucknow": { code: "LKO", lat: 26.8407, lng: 80.9388 },
                    "Urmia": { code: "OMH", lat: 37.5529, lng: 45.0761 },
                    "Baku": { code: "GYD", lat: 40.3755, lng: 49.8327 },
                    "Kampala": { code: "EBB", lat: 0.3476, lng: 32.5825 },
                    "Yogyakarta": { code: "JOG", lat: -7.7956, lng: 110.3695 },
                    "Kaohsiung": { code: "KHH", lat: 22.6273, lng: 120.3014 },
                    "Ho Chi Minh City": { code: "SGN", lat: 10.8231, lng: 106.6297 },
                    "Bendigo": { code: "MEL", lat: -36.7570, lng: 144.2794 }, // Bendigo is near MEL
                    "North Harbour": { code: "AKL", lat: -36.8049, lng: 174.7735 }, // Auckland
                    "Glasgow": { code: "GLA", lat: 55.8642, lng: -4.2518 },
                    "Cardiff": { code: "CWL", lat: 51.4816, lng: -3.1791 },
                    "Dublin": { code: "DUB", lat: 53.3498, lng: -6.2603 },
                    "Lisbon": { code: "LIS", lat: 38.7223, lng: -9.1393 },
                    "Caldas da Rainha": { code: "LIS", lat: 39.4072, lng: -9.1345 }, // Near Lisbon
                    "Graz": { code: "GRZ", lat: 47.0707, lng: 15.4395 },
                    "Vienna": { code: "VIE", lat: 48.2082, lng: 16.3738 },
                    "Milan": { code: "MIL", lat: 45.4642, lng: 9.1900 },
                    "Brno": { code: "BRQ", lat: 49.1951, lng: 16.6068 },
                    "Tallinn": { code: "TLL", lat: 59.4370, lng: 24.7536 },
                    "Uppsala": { code: "ARN", lat: 59.8586, lng: 17.6389 }, // Near Arlanda
                    "Almere": { code: "AMS", lat: 52.3680, lng: 5.2243 }, // Near Amsterdam
                    "Gwangju": { code: "KWJ", lat: 35.1595, lng: 126.8526 },
                    "Ruichang": { code: "KHN", lat: 29.6766, lng: 115.6558 }, // Near Nanchang
                    "Baoji": { code: "XIY", lat: 34.3644, lng: 107.2370 }, // Near Xi'an
                    "Nanchang": { code: "KHN", lat: 28.6830, lng: 115.8575 },
                    "Haiko": { code: "HAK", lat: 20.0174, lng: 110.3492 },
                    "Nanjing": { code: "NKG", lat: 32.0603, lng: 118.7969 },
                    "Lingshui": { code: "SYX", lat: 18.5029, lng: 110.0384 }, // Near Sanya
                    // Generic
                    "USA": { code: "JFK", lat: 40.7128, lng: -74.0060 }, // Default fallback
                    "West": { code: "LAX", lat: 34.0522, lng: -118.2437 },
                    "East": { code: "JFK", lat: 40.7128, lng: -74.0060 }
                };

                // Helper: Get City Data
                const getCityInfo = (cityName) => {
                    if (!cityName) return { code: 'XXX', lat: 0, lng: 0 };

                    // Try exact match
                    if (CITY_DATA[cityName]) return CITY_DATA[cityName];

                    // Try exact match Case Insensitive
                    const keys = Object.keys(CITY_DATA);
                    const match = keys.find(k => k.toLowerCase() === cityName.toLowerCase());
                    if (match) return CITY_DATA[match];

                    // Try Cleaned match (split by comma, e.g. "Paris, France" -> "Paris")
                    const clean = cityName.split(',')[0].trim();
                    if (CITY_DATA[clean]) return CITY_DATA[clean];

                    // Try finding partial match in keys
                    const partial = keys.find(k => cityName.includes(k));
                    if (partial) return CITY_DATA[partial];

                    // Default fallback
                    console.warn(`City not found in database: ${cityName}`);
                    return { code: 'XXX', lat: 0, lng: 0 };
                };

                // ‚úÖ NEW: generateAffiliateLinks (Deep Linking Logic)
                const generateAffiliateLinks = (homeAirport, tournaments, markerId) => {
                    // 1. Flight Logic (Aviasales Multi-City)
                    // Pattern: Origin1Date1Dest1Origin2Date2Dest2... (Explicit Segments)

                    let flightSegments = "";

                    // Sort tournaments
                    const sortedTournaments = [...tournaments].sort((a, b) => new Date(a.startIso) - new Date(b.startIso));

                    // Use explicit Origin tracking
                    let currentOrigin = homeAirport;

                    // Loop through tournaments
                    sortedTournaments.forEach((t, index) => {
                        const cityInfo = getCityInfo(t.city);
                        const destCode = cityInfo ? cityInfo.code : 'XXX';

                        let travelDate;
                        if (index === 0) {
                            // First Leg: Home -> T1 (Arrive 2 days early)
                            travelDate = new Date(t.startIso);
                            travelDate.setDate(travelDate.getDate() - 2);
                        } else {
                            // Inter-tournament: PrevT -> T (Depart on PrevT End Date)
                            const prevT = sortedTournaments[index - 1];
                            travelDate = new Date(prevT.endIso);
                        }

                        const dStr = travelDate.getDate().toString().padStart(2, '0') + (travelDate.getMonth() + 1).toString().padStart(2, '0');

                        // Append Segment explicitly: Origin + Date + Dest
                        flightSegments += `${currentOrigin}${dStr}${destCode}`;

                        // Update origin for next leg
                        currentOrigin = destCode;
                    });

                    // Return Leg: LastT -> Home
                    const lastT = sortedTournaments[sortedTournaments.length - 1];
                    const returnDate = new Date(lastT.endIso);
                    const rStr = returnDate.getDate().toString().padStart(2, '0') + (returnDate.getMonth() + 1).toString().padStart(2, '0');

                    flightSegments += `${currentOrigin}${rStr}${homeAirport}`;

                    // Add passengers/marker
                    const flightUrl = `https://www.aviasales.com/search/${flightSegments}?marker=${markerId}`;

                    // 2. Hotel Links (Hotellook Map View)
                    const hotelLinks = [];
                    sortedTournaments.forEach(t => {
                        const cityInfo = getCityInfo(t.city);
                        if (cityInfo) {
                            const checkIn = new Date(t.startIso);
                            checkIn.setDate(checkIn.getDate() - 2);
                            const checkInStr = checkIn.toISOString().split('T')[0];
                            const checkOutStr = t.endIso;

                            const url = `https://search.hotellook.com/hotels?lat=${cityInfo.lat}&lng=${cityInfo.lng}&checkIn=${checkInStr}&checkOut=${checkOutStr}&adults=1&marker=${markerId}&language=ko&zoom=15`;
                            hotelLinks.push({ name: t.name, url: url });
                        }
                    });

                    // 3. Transport (Placeholder)
                    const transportLinks = [];

                    return { flightUrl, hotelLinks, transportLinks };
                };

                const currCityName = (full) => full.split(',')[0].trim();

                // ‚úÖ NEW: Enhanced getSearchUrl using Affiliate Logic
                const getSearchUrl = (type, city, startIso, endIso) => {
                    const cityInfo = getCityInfo(city);

                    if (type === 'hotel' && cityInfo) {
                        const checkIn = new Date(startIso);
                        checkIn.setDate(checkIn.getDate() - 2);
                        const checkInStr = checkIn.toISOString().split('T')[0];
                        return `https://search.hotellook.com/hotels?lat=${cityInfo.lat}&lng=${cityInfo.lng}&checkIn=${checkInStr}&checkOut=${endIso}&adults=1&marker=${MARKER_ID}&language=ko&zoom=15`;
                    }

                    // Fallback to Google Logic if data missing or for single flight (which needs home airport - tricky for single button)
                    if (!startIso || !endIso) return '#';
                    const startDate = new Date(startIso);
                    startDate.setDate(startDate.getDate() - 2);
                    const arriveDate = startDate.toISOString().split('T')[0];
                    const departDate = endIso;

                    if (type === 'flight') return `https://www.google.com/search?q=flight+to+${city}+from+${arriveDate}+to+${departDate}`;
                    else return `https://www.google.com/search?q=hotel+in+${city}+from+${arriveDate}+to+${departDate}`;
                };



                // ‚úÖ Ï∂îÍ∞Ä: t Ìï®ÏàòÎ•º Î®ºÏ†Ä Ï†ïÏùò (runSimulationÏóêÏÑú ÏÇ¨Ïö©ÌïòÍ∏∞ ÎïåÎ¨∏)
                const t = (key) => (i18nData[currentLang.value] || i18nData.en)[key] || key;

                // ‚úÖ Ï∂îÍ∞Ä: Í≤ÄÏ¶ù Î©îÏãúÏßÄ Ìï®Ïàò
                const getValidationMessage = () => {
                    if (!sim.guestPoints) {
                        return t('msgEnterPoints');
                    }
                    // ‚úÖ ÏàòÏ†ï: ÌååÌä∏ÎÑà Ìè¨Ïù∏Ìä∏Îäî ÏÑ†ÌÉùÏÇ¨Ìï≠ÏúºÎ°ú Î≥ÄÍ≤Ω
                    // if (sim.type === 'doubles' && !sim.partnerPoints) {
                    //     return t('msgEnterPartnerPoints');
                    // }
                    return t('fillRequiredFields');
                };

                // ‚úÖ ÏàòÏ†ï: Î≥µÏãù Ìè¨Ïù∏Ìä∏ Í≥ÑÏÇ∞ Î°úÏßÅ Í∞úÏÑ† (BWF Í∑úÏ†ïÏóê ÎßûÍ≤å)
                const runSimulation = () => {
                    if (!sim.guestPoints) {
                        alert(t('alertEnterPoints'));
                        return;
                    }

                    if (!isFormValid.value) {
                        alert(t('alertInvalidPoints'));
                        return;
                    }

                    sim.loading = true;
                    sim.results = null;
                    selectedTournaments.value = [];  // Reset selection

                    // ‚úÖ NEW: Reset and Start Log-Based Loading Animation
                    loadingLogs.value.forEach(log => log.done = false);
                    loadingProgress.value = 0;

                    // Clear old timer if exists
                    if (timerState.intervalId) clearInterval(timerState.intervalId);

                    // Simulate progressive loading with logs
                    const logTimings = [0, 150, 300, 450, 600]; // Milliseconds for each step
                    logTimings.forEach((delay, index) => {
                        setTimeout(() => {
                            loadingLogs.value[index].done = true;
                            loadingProgress.value = ((index + 1) / loadingLogs.value.length) * 100;
                        }, delay);
                    });

                    let entryPoints = 0;

                    entryPoints = sim.guestPoints;
                    if (sim.type === 'doubles') {
                        // ‚úÖ ÏàòÏ†ï: ÌååÌä∏ÎÑà Ìè¨Ïù∏Ìä∏Í∞Ä ÏóÜÏúºÎ©¥ ÎÇ¥ Ìè¨Ïù∏Ìä∏Îßå ÏÇ¨Ïö©
                        let pPoints = sim.partnerPoints || 0;
                        let pairTotal = (entryPoints + pPoints);

                        if (sim.calcMethod === 'normal') {
                            entryPoints = pairTotal;
                        }
                        else if (sim.calcMethod === 'notional') {
                            // ‚úÖ ÏàòÏ†ï: BWF Í∑úÏ†ïÏóê ÎßûÍ≤å ÏàòÏ†ï - ÎÜíÏùÄ Ï™Ω Ìè¨Ïù∏Ìä∏Ïùò 80%
                            entryPoints = Math.max(sim.guestPoints, pPoints) * 0.8;
                        }
                        else {
                            const factors = { '5': 2.0, '6': 1.66, '7': 1.42, '8': 1.25 };
                            entryPoints = pairTotal * (factors[sim.playedCount] || 1);
                        }
                    }

                    sim.finalPoints = Math.floor(entryPoints);

                    setTimeout(() => {
                        // Clear timer
                        if (timerState.intervalId) {
                            clearInterval(timerState.intervalId);
                            timerState.intervalId = null;
                        }

                        // ‚úÖ NEW: Load tournaments from 2026_tournaments.js first, fallback to tournaments.js
                        const real2026Tournaments = window.tournaments2026 || [];
                        const legacyTournaments = window.tournamentData || [];

                        let tournamentsToUse = [];

                        if (real2026Tournaments.length > 0) {
                            // Use real 2026 tournament data - format it for the app
                            tournamentsToUse = real2026Tournaments.map(t => ({
                                name: t.name,
                                city: t.city,
                                country: t.country,
                                region: t.region,
                                grade: t.grade,
                                dates: `${t.startDate} ~ ${t.endDate}`,
                                entryDeadline: t.startDate, // Use start date as deadline for now
                                status: 'OPEN',
                                cutoff: 0 // Will be predicted
                            }));
                        } else {
                            // Fallback removed to force 2026 data usage
                            tournamentsToUse = [];
                            console.warn('No 2026 tournament data found');
                        }

                        const today = new Date().toISOString().split('T')[0];

                        // Filter: Only OPEN tournaments with future entry deadlines
                        const availableTournaments = tournamentsToUse.filter(t => {
                            // Handle special deadlines (Selection, Qualification, etc.)
                            if (typeof t.entryDeadline === 'string' &&
                                (t.entryDeadline.includes('Selection') ||
                                    t.entryDeadline.includes('Qualification') ||
                                    t.entryDeadline.includes('Ranking'))) {
                                return t.status === 'OPEN';
                            }
                            return t.entryDeadline >= today && t.status === 'OPEN';
                        });

                        // Map to expected format
                        const formattedTournaments = availableTournaments.map(t => {
                            // Parse dates from "2026-01-06 ~ 2026-01-11" format
                            const dateParts = t.dates.split('~');
                            const startIso = dateParts[0].trim();
                            const endIso = dateParts[1] ? dateParts[1].trim() : startIso;

                            // Format date for display: "Jan 06-11"
                            const startDate = new Date(startIso);
                            const endDate = new Date(endIso);
                            const monthStr = startDate.toLocaleString('en-US', { month: 'short' });
                            const startDay = startDate.getDate();
                            const endDay = endDate.getDate();
                            const dateDisplay = `${monthStr} ${startDay < 10 ? '0' : ''}${startDay}-${endDay < 10 ? '0' : ''}${endDay}`;

                            // Calculate WD deadline (7 days before tournament)
                            const wdDate = new Date(startIso);
                            wdDate.setDate(wdDate.getDate() - 7);
                            const wdDeadline = wdDate.toISOString().split('T')[0];

                            // Get cutoff points (handle both old and new formats)
                            const cutOff = t.cutOffPoints?.main || t.cutoff || 0;

                            // Short grade format (Abbreviated)
                            let shortGrade = t.grade || '';

                            // 1. Remove standard prefixes
                            shortGrade = shortGrade
                                .replace(/HSBC BWF World Tour Super/g, 'S')
                                .replace(/BWF Tour Super/g, 'S')
                                .replace(/Super/g, 'S')
                                .replace(/Grade/g, 'G');

                            // 2. Map Juniors specific titles (First pass)
                            shortGrade = shortGrade
                                .replace(/Junior International Challenge/g, 'JIC')
                                .replace(/Junior International Series/g, 'JIS')
                                .replace(/Junior Future Series/g, 'JFS')
                                .replace(/Junior International Grand Prix/g, 'JIGP');

                            // 3. Map Seniors specific titles
                            shortGrade = shortGrade
                                .replace(/International Challenge/g, 'IC')
                                .replace(/International Series/g, 'IS')
                                .replace(/Future Series/g, 'FS');

                            // 4. Map Championships
                            shortGrade = shortGrade
                                .replace(/Continental Junior Individual Championships/g, 'CJIC')
                                .replace(/Continental Individual Championships/g, 'CIC');

                            // 5. Clean up leftovers
                            shortGrade = shortGrade
                                .replace(/Junior/g, 'Jnr')
                                .replace(/Grand Prix/g, 'GP')
                                .replace(/S\s+/g, 'S') // Remove space after S (S 1000 -> S1000)
                                .trim();

                            // 6. Handle empty grades with Name-based U-event detection
                            if (!shortGrade && (t.name.includes('U19') || t.name.includes('U17') || t.name.includes('U15') || t.name.includes('U13'))) {
                                const match = t.name.match(/U\d{2}/);
                                if (match) shortGrade = match[0];
                            }

                            return {
                                name: t.name,
                                shortGrade: shortGrade.trim(),
                                grade: t.grade, // ‚úÖ Pass original grade for filtering
                                city: t.city,
                                country: t.country,
                                date: dateDisplay,
                                cutOff: typeof cutOff === 'number' ? cutOff : 0,
                                entryDeadline: t.entryDeadline,
                                wdDeadline: wdDeadline,
                                startIso: startIso,
                                endIso: endIso
                            };
                        });

                        // Helper to get estimated points if cutoff is missing
                        // Based on 2025 Season Average Entrants
                        const getPointsByGrade = (grade) => {
                            if (!grade) return 0;
                            // Estimated cutoffs for Main Draw (approximate based on 2025 trends)
                            if (grade.includes('S1000')) return 47000;  // High demand
                            if (grade.includes('S750')) return 39000;   // Solid top 32
                            if (grade.includes('S500')) return 29000;   // Competitive
                            if (grade.includes('S300')) return 21000;   // Strong field
                            if (grade.includes('S100')) return 9000;    // Emerging pros
                            if (grade.includes('GP')) return 6000;
                            if (grade.includes('IC')) return 6000;      // Int. Challenge (Raised)
                            if (grade.includes('JIC')) return 2500;     // Jr. Int. Challenge
                            if (grade.includes('IS')) return 3000;      // Int. Series (Raised)
                            if (grade.includes('JIS')) return 1500;     // Jr. Int. Series
                            if (grade.includes('FS')) return 1500;      // Future Series
                            if (grade.includes('JFS')) return 800;      // Jr. Future Series
                            if (grade.includes('U19') || grade.includes('Jnr')) return 800;
                            return 1000; // Default fallback
                        };

                        sim.results = formattedTournaments.map(tournament => {
                            // If data has no cutoff, use estimate based on grade
                            let cutoffValue = tournament.cutOff;
                            if (!cutoffValue || cutoffValue === 0) {
                                cutoffValue = getPointsByGrade(tournament.shortGrade);
                            }

                            let prediction = '', diff = sim.finalPoints - cutoffValue, statusKey = '';

                            if (sim.currentRank && sim.currentRank <= 10 && (tournament.shortGrade.includes('S1000') || tournament.shortGrade.includes('S750'))) {
                                statusKey = 'mandatory';
                                prediction = t('mandatory');
                            }
                            else if (diff >= 2000) {
                                statusKey = 'main';
                                prediction = t('mainSafe');
                            }
                            else if (diff >= 0) {
                                statusKey = 'qual';
                                prediction = t('qualMain');
                            }
                            else if (diff >= -3000) {
                                statusKey = 'promo';
                                prediction = t('promoProbable');
                            }
                            else {
                                statusKey = 'reserve';
                                prediction = `${t('reserve')} (-${Math.abs(diff).toLocaleString()})`;
                            }

                            // Append cutoff info to prediction for clarity
                            const cutoffDisplay = cutoffValue > 0 ? ` (Cut: ${cutoffValue.toLocaleString()})` : '';
                            prediction += cutoffDisplay;

                            // ‚úÖ NEW: Add unique ID for selection
                            const id = `${tournament.name}-${tournament.startIso}`;
                            return { ...tournament, id, prediction, diff, statusKey };
                        }).sort((a, b) => a.startIso.localeCompare(b.startIso));

                        sim.loading = false;
                    }, 800);
                };

                // Toggle grade filter
                const toggleGradeFilter = (grade) => {
                    const index = filters.selectedGrades.indexOf(grade);
                    if (index > -1) {
                        filters.selectedGrades.splice(index, 1);
                    } else {
                        filters.selectedGrades.push(grade);
                    }
                };

                // Toggle region filter
                const toggleRegionFilter = (region) => {
                    const index = filters.selectedRegions.indexOf(region);
                    if (index > -1) {
                        filters.selectedRegions.splice(index, 1);
                    } else {
                        filters.selectedRegions.push(region);
                    }
                };

                // Map tournament region based on country
                const getTournamentRegion = (country) => {
                    if (!country) return 'Asia';

                    const countryUpper = country.toUpperCase();

                    const regionMap = {
                        'Asia': ['CHINA', 'JAPAN', 'KOREA', 'INDONESIA', 'MALAYSIA', 'THAILAND', 'INDIA', 'SINGAPORE', 'CHINESE TAIPEI', 'HONG KONG', 'VIETNAM', 'PAKISTAN', 'BANGLADESH', 'SRI LANKA', 'PHILIPPINES', 'MALDIVES', 'NEPAL', 'MYANMAR', 'KAZAKHSTAN', 'UZBEKISTAN', 'IRAN', 'BAHRAIN', 'UAE', 'UNITED ARAB EMIRATES', 'SAUDI ARABIA', 'QATAR', 'JORDAN', 'LEBANON', 'SYRIA', 'IRAQ', 'KUWAIT', 'OMAN', 'YEMEN', 'CAMBODIA', 'LAOS', 'BRUNEI', 'TIMOR-LESTE', 'AFGHANISTAN', 'MONGOLIA', 'MACAU', 'TAJIKISTAN', 'KYRGYZSTAN', 'TURKMENISTAN'],

                        'Europe': ['DENMARK', 'ENGLAND', 'Great Britain', 'FRANCE', 'GERMANY', 'SPAIN', 'SWITZERLAND', 'NETHERLANDS', 'SWEDEN', 'ITALY', 'RUSSIA', 'POLAND', 'CZECHIA', 'CZECH REPUBLIC', 'UKRAINE', 'BELGIUM', 'AUSTRIA', 'IRELAND', 'SCOTLAND', 'WALES', 'FINLAND', 'NORWAY', 'PORTUGAL', 'GREECE', 'BULGARIA', 'ESTONIA', 'LATVIA', 'LITHUANIA', 'HUNGARY', 'SLOVAKIA', 'SLOVENIA', 'CROATIA', 'SERBIA', 'BOSNIA', 'ROMANIA', 'MOLDOVA', 'TURKIYE', 'TURKEY', 'CYPRUS', 'MALTA', 'ICELAND', 'LUXEMBOURG', 'AZERBAIJAN', 'ARMENIA', 'GEORGIA', 'ISRAEL', 'BELARUS', 'FAROE ISLANDS'],

                        'PanAm': ['USA', 'U.S.A.', 'CANADA', 'MEXICO', 'BRAZIL', 'ARGENTINA', 'CHILE', 'PERU', 'COLOMBIA', 'GUATEMALA', 'EL SALVADOR', 'CUBA', 'JAMAICA', 'DOMINICAN REPUBLIC', 'BARBADOS', 'TRINIDAD', 'TOBAGO', 'SURINAME', 'GUYANA', 'VENEZUELA', 'ECUADOR', 'BOLIVIA', 'PARAGUAY', 'URUGUAY', 'COSTA RICA', 'PANAMA', 'HONDURAS', 'NICARAGUA', 'BELIZE', 'HAITI', 'BAHAMAS', 'BERMUDA', 'CAYMAN ISLANDS', 'GREENLAND', 'FALKLAND ISLANDS', 'NORTHERN MARIANA ISLANDS'],

                        'Africa': ['EGYPT', 'SOUTH AFRICA', 'ALGERIA', 'NIGERIA', 'MAURITIUS', 'ZIMBABWE', 'UGANDA', 'ZAMBIA', 'KENYA', 'GHANA', 'CAMEROON', 'MOROCCO', 'TUNISIA', 'BOTSWANA', 'NAMIBIA', 'MOZAMBIQUE', 'MADAGASCAR', 'SEYCHELLES', 'ETHIOPIA', 'TANZANIA', 'IVORY COAST', 'BENIN', 'TOGO', 'BURKINA FASO', 'SENEGAL', 'CONGO', 'MALI', 'GABON', 'REUNION'],

                        'Oceania': ['AUSTRALIA', 'NEW ZEALAND', 'FIJI', 'NEW CALEDONIA', 'TAHITI', 'SAMOA', 'TUVALU', 'KIRIBATI', 'TONGA', 'GUAM', 'COOK ISLANDS', 'NORFOLK ISLAND', 'NORTHERN MARIANA ISLANDS', 'PAPUA NEW GUINEA']
                    };

                    for (const [region, countries] of Object.entries(regionMap)) {
                        // Check for exact match or partial match (e.g. "Hong Kong China" matches "HONG KONG")
                        if (countries.some(c => countryUpper.includes(c))) {
                            return region;
                        }
                    }
                    return 'Asia'; // Default
                };

                const filteredResults = computed(() => {
                    if (!sim.results) return [];

                    return sim.results.filter(tournament => {
                        // Region filter
                        if (filters.selectedRegions.length > 0) {
                            const tournamentRegion = getTournamentRegion(tournament.country || '');
                            if (!filters.selectedRegions.includes(tournamentRegion)) return false;
                        }

                        // Check if it is a Junior tournament
                        const grade = (tournament.grade || '').toLowerCase();
                        const name = (tournament.name || '').toLowerCase();
                        const isJunior = grade.includes('junior') || name.includes('junior') ||
                            grade.includes('u19') || name.includes('u19') ||
                            grade.includes('u17') || name.includes('u17') ||
                            grade.includes('u15') || name.includes('u15') ||
                            grade.includes('u13') || name.includes('u13') ||
                            grade.includes('youth');

                        // ‚úÖ Junior Logic: 
                        // If 'Junior' filter is NOT active, HIDE all Junior tournaments (default behavior)
                        if (!filters.selectedGrades.includes('Junior') && isJunior) return false;

                        // Grade filter
                        if (filters.selectedGrades.length > 0) {
                            // If 'Junior' is active and this IS a Junior tournament, SHOW it.
                            if (isJunior && filters.selectedGrades.includes('Junior')) return true;

                            // For non-Junior tournaments, check other grades
                            // We filter out 'Junior' from the checking list so it doesn't match 'Junior' string in non-junior grades (if any)
                            const otherGrades = filters.selectedGrades.filter(g => g !== 'Junior');

                            if (otherGrades.length > 0) {
                                const hasMatchingGrade = otherGrades.some(grade =>
                                    tournament.shortGrade.includes(grade)
                                );
                                if (!hasMatchingGrade) return false;
                            } else {
                                // If ONLY 'Junior' is selected, and this is NOT a Junior tournament -> Hide it
                                return false;
                            }
                        }

                        return true;
                    });
                });

                const shareResults = () => {
                    const params = new URLSearchParams();
                    params.set('type', sim.type);
                    params.set('event', sim.guestEvent);
                    if (sim.guestPoints) params.set('pts', sim.guestPoints);
                    if (sim.currentRank) params.set('rank', sim.currentRank);
                    if (sim.type === 'doubles') {
                        if (sim.partnerPoints) params.set('ppts', sim.partnerPoints);
                        params.set('method', sim.calcMethod);
                        if (sim.calcMethod === 'adjusted') params.set('cnt', sim.playedCount);
                    }
                    const url = `${window.location.origin}${window.location.pathname}?${params.toString()}`;

                    if (navigator.share) {
                        navigator.share({
                            title: 'Court Mate Prediction',
                            text: 'Check out my tournament entry forecast!',
                            url: url
                        }).catch(console.error);
                    }
                    else {
                        navigator.clipboard.writeText(url)
                            .then(() => alert('Link copied to clipboard!'))
                            .catch(() => prompt("Copy link:", url));
                    }
                };

                const copyEmail = () => {
                    const email = 'roumsne@gmail.com';
                    navigator.clipboard.writeText(email)
                        .then(() => {
                            alert('Email copied to clipboard!\n' + email);
                        })
                        .catch((err) => {
                            console.error('Failed to copy email:', err);
                            alert('Failed to copy email. Please copy manually: ' + email);
                        });
                };

                const copyAgentEmail = () => {
                    const email = 'withm2k@gmail.com';
                    navigator.clipboard.writeText(email)
                        .then(() => {
                            alert('Agent email copied to clipboard!\n' + email);
                        })
                        .catch((err) => {
                            console.error('Failed to copy email:', err);
                            alert('Failed to copy email. Please copy manually: ' + email);
                        });
                };

                const checkUrlParams = () => {
                    const params = new URLSearchParams(window.location.search);
                    if (params.has('event')) {
                        sim.type = params.get('type') || 'singles';
                        sim.guestEvent = params.get('event');
                        if (params.has('pts')) sim.guestPoints = Number(params.get('pts'));
                        if (params.has('rank')) sim.currentRank = Number(params.get('rank'));
                        if (sim.type === 'doubles') {
                            if (params.has('ppts')) sim.partnerPoints = Number(params.get('ppts'));
                            if (params.has('method')) sim.calcMethod = params.get('method');
                            if (params.has('cnt')) sim.playedCount = params.get('cnt');
                        }
                        if (sim.guestPoints) runSimulation();
                    }
                };

                // ‚úÖ Ï∂îÍ∞Ä: ÏÜåÏÖú ÎØ∏ÎîîÏñ¥ Ïó¥Í∏∞ Ìï®Ïàò
                const openSocial = (platform) => {
                    // Ïã§Ï†ú ÏÑúÎπÑÏä§ÏóêÏÑúÎäî Ïó¨Í∏∞Ïóê Îî•ÎßÅÌÅ¨ÎÇò URLÏùÑ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî
                    const links = {
                        wechat: 'weixin://',
                        kakao: 'kakaotalk://',
                        line: 'line://'
                    };

                    if (links[platform]) {
                        window.location.href = links[platform];
                    } else {
                        alert(`Open ${platform}`);
                    }
                };

                // Toggle Dark Mode
                const toggleDarkMode = () => {
                    darkMode.value = !darkMode.value;
                    if (darkMode.value) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('darkMode', 'true');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('darkMode', 'false');
                    }
                };

                // ‚úÖ Ï∂îÍ∞Ä: Í≤ÄÏÉâÏ∞Ω Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ï≤òÎ¶¨
                onMounted(() => {
                    // Load dark mode preference
                    const savedDarkMode = localStorage.getItem('darkMode');
                    if (savedDarkMode === 'true') {
                        darkMode.value = true;
                        document.body.classList.add('dark-mode');
                    }

                    document.documentElement.lang = currentLang.value;

                    // ‚úÖ NEW: Load Remembered Player
                    const savedRememberMe = localStorage.getItem('courtmate_remember_me');
                    if (savedRememberMe === 'true') {
                        rememberPlayer.value = true;
                        const savedPlayerData = localStorage.getItem('courtmate_saved_player');
                        if (savedPlayerData) {
                            try {
                                const parsedPlayer = JSON.parse(savedPlayerData);
                                // We need to re-select this player
                                // But selectPlayer expects a player object from the list or similar structure
                                // parsedPlayer should have everything we need
                                selectPlayer(parsedPlayer);
                            } catch (e) {
                                console.error("Failed to parse saved player data", e);
                            }
                        }
                    } else {
                        rememberPlayer.value = false;
                    }

                    checkUrlParams();

                    // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Í≤ÄÏÉâ Í≤∞Í≥º Îã´Í∏∞
                    document.addEventListener('click', (e) => {
                        const searchContainer = e.target.closest('.mb-4.relative');
                        if (!searchContainer && showSearchResults.value) {
                            showSearchResults.value = false;
                        }
                    });
                });

                // ‚úÖ NEW: Watch for Language Changes
                watch(currentLang, (newLang) => {
                    localStorage.setItem('courtmate_lang', newLang);
                    document.documentElement.lang = newLang;
                });

                // Toggle tournament selection
                const toggleTournamentSelection = (id) => {
                    const index = selectedTournaments.value.indexOf(id);
                    if (index > -1) {
                        selectedTournaments.value.splice(index, 1);
                    } else {
                        if (selectedTournaments.value.length < 3) {
                            selectedTournaments.value.push(id);
                        }
                    }
                };

                // ‚úÖ NEW: Circuit Planner State
                const showCircuitModal = ref(false);
                const circuitHomeCityQuery = ref('');
                const circuitHomeCode = ref('');
                const citySuggestions = ref([]);
                const whiteLabelDomain = 'www.aviasales.com'; // Or custom white label domain

                // ‚úÖ NEW: Fetch City Suggestions (Travelpayouts API)
                const fetchCitySuggestions = async () => {
                    const query = circuitHomeCityQuery.value;
                    if (query.length < 2) {
                        citySuggestions.value = [];
                        return;
                    }

                    try {
                        const response = await fetch(`https://autocomplete.travelpayouts.com/places2?term=${encodeURIComponent(query)}&locale=ko&types[]=city`);
                        const data = await response.json();
                        citySuggestions.value = data.slice(0, 5); // Limit to top 5
                    } catch (error) {
                        console.error("Failed to fetch cities:", error);
                    }
                };

                // ‚úÖ NEW: Select Home City
                const selectHomeCity = (city) => {
                    circuitHomeCode.value = city.code;
                    circuitHomeCityQuery.value = `${city.name} (${city.code})`;
                    citySuggestions.value = []; // Clear suggestions
                };

                // Helper to get city code from tournament ID
                const getCityCode = (tId) => {
                    // tId format: "Name-StartIso"
                    // We need to find the tournament object
                    const t = sim.results.find(r => r.id === tId);
                    if (!t) return 'XXX';
                    const cityInfo = getCityInfo(t.city);
                    return cityInfo ? cityInfo.code : 'XXX';
                };

                // ‚úÖ NEW: Generate Comparison Deep Link
                const generateComparisonLink = () => {
                    if (!circuitHomeCode.value || selectedTournaments.value.length < 2) return;

                    // Filter selected objects
                    const tourneys = sim.results.filter(r => selectedTournaments.value.includes(r.id));

                    // Use the existing logic but adapted for the direct link generation
                    // We need to construct the URL: domain/search/{Segments}1?marker=...

                    // Re-use logic or call helper? 
                    // Let's call the helper but we need to override the home airport.
                    const links = generateAffiliateLinks(circuitHomeCode.value, tourneys, MARKER_ID);

                    // The helper returns `flightUrl`. 
                    // verify it matches the requirement: .../search/{Origin}{Date1}{Dest}...1?marker=...
                    // My previous implementation of `generateAffiliateLinks` already does this!
                    // It produces: https://www.aviasales.com/search/...

                    // Open the link
                    window.open(links.flightUrl, '_blank');

                    // Close modal
                    showCircuitModal.value = false;
                };

                // ‚úÖ NEW: Plan Circuit (Opens Modal)
                const planCircuit = () => {
                    if (selectedTournaments.value.length < 2) {
                        alert(t('selectTournaments'));
                        return;
                    }
                    // Reset State
                    circuitHomeCityQuery.value = '';
                    circuitHomeCode.value = '';
                    citySuggestions.value = [];
                    showCircuitModal.value = true;
                };

                watch(currentLang, (newVal) => {
                    document.documentElement.lang = newVal;
                });

                return {
                    currentLang,
                    t,
                    showConsultModal,
                    sim,
                    runSimulation,
                    filteredResults,
                    getSearchUrl,
                    shareResults,
                    copyEmail,
                    copyAgentEmail,
                    searchQuery,
                    showSearchResults,
                    searchResults,
                    selectPlayer,
                    clearSearch,
                    formatPoints,
                    dataLoadError,
                    validationErrors,
                    validateInputs,
                    isFormValid,
                    openSocial,
                    getValidationMessage,
                    // ‚úÖ NEW: Export new state variables
                    filters,
                    timerState,
                    selectedTournaments,
                    playerNationality,
                    loadingLogs,
                    loadingProgress,
                    darkMode,
                    toggleDarkMode,
                    toggleGradeFilter,
                    toggleRegionFilter,
                    toggleTournamentSelection,
                    planCircuit,
                    // ‚úÖ NEW: Circuit Planner Exports
                    showCircuitModal,
                    circuitHomeCityQuery,
                    circuitHomeCode,
                    citySuggestions,
                    fetchCitySuggestions,
                    selectHomeCity,
                    generateComparisonLink,
                    getCityCode
                };
            }
        }).mount('#app');
    </script>
</body>

</html>